Weather and Climate Dynamics, 2, 581–608 (2021)
https://doi.org/10.5194/wcd-2-581-2021
© Author(s) 2021, CC BY 4.0

機械学習によるブロッキング検出：欧州夏季を対象とした教師なし学習アプローチ
An unsupervised learning approach to identifying blocking events: the case of European summer

著者
- Carl Thomas1（連絡先: c.thomas18@imperial.ac.uk）
- Apostolos Voulgarakis1,2
- Gerald Lim3
- Joanna Haigh1,4
- Peer Nowack1,4,5,6
1 Imperial College London, Department of Physics, UK
2 Technical University of Crete, School of Environmental Engineering, Greece
3 Centre for Climate Research Singapore
4 Grantham Institute, Imperial College London
5 Climatic Research Unit, UEA, UK
6 Data Science Institute, Imperial College London

概要（要旨）
- 背景: 中緯度の大気ブロッキングは偏西風の進路を遮断する準定常の高気圧場で、夏季の熱波・冬季の寒波と結びつく。しかし、ブロッキングの履歴データセットは統一的な定義がなく、多様なブロッキング指標（BI）が併用されている（地域・季節で感度差が大きい）。
- 目的: 教師なし機械学習の自己組織化マップ（Self-Organizing Maps: SOM）を用いた新たなブロッキング指標（SOM-BI）を提案し、広く用いられている従来のBIと比較・評価する。
- 方法: 欧州夏季（JJA）1979–2019を対象に、専門家判断に基づく5日持続のブロッキング有無の二値系列（Ground Truth Dataset: GTD）を構築。ERA5再解析を主データ、UKESM1-0-LL（UKESM）プレ産業制御走行（約100年）をモデルデータとして用いた。SOM-BIは入力場の空間情報を最大限活用し、恣意的な閾値依存性を低減する。
- 主結果:
  - ERA5（1979–2019, JJA）において、SOM-BIは精度（precision）・再現率（recall）・F1の指標で従来インデックスを上回る。特に500 hPa高度偏差（Z500 anomaly）を入力に用いた場合が最良。
  - 学習に必要な訓練年数は約20年で十分（観測期間で足りる）。
  - 2003年・2019年欧州熱波の事例解析で、SOMノード群の集合によりイベント診断が可能（ただしドメイン境界・手法特性により識別誤差を生じる場合もある）。
  - UKESMプレ産業制御（約100年）でもSOM-BIは従来BIより良好な性能を示す。モデルでは全体的にインデックス性能が低下するが、SOM-BIの優位が顕著。
  - SOM-BIはブロッキングのタイプ分け・傾向把握にも利用可能で、Z500が最適、MSLPが次善、PV関連変数は相対的に劣る。
- 含意: 教師なし学習は、再解析・気候モデルの双方でブロッキング研究を補完しうる有望なアプローチである。

1. 序論
- ブロッキングは数日以上持続する準定常的な中緯度高気圧で、夏季の熱波、冬季の寒波と関連（Rex, 1950; Black et al., 2004; Cattiaux et al., 2010）。
- 近年の研究では、ブロッキングの季節内・年々・十年規模の変動が大きく（Kennedy et al., 2016; Brunner et al., 2017）、外部強制・内部変動の分離が難しい（Barnes et al., 2014; Shepherd, 2014）。気候変動影響も未解決の課題（Barnes, 2013; Woollings et al., 2018）。
- ブロッキングの自動検出には多くの指標（BI）が提案されており、しきい値設定の主観性・地域季節依存性が課題（Croci-Maspoli et al., 2007; Barriopedro et al., 2010; Pinheiro et al., 2019）。
- 本研究は、GTD（専門家判断の二値化）を作成し、SOMを用いたBI（SOM-BI）を開発、従来BIと直接の時系列比較を行う。

2. データと方法
2.1 データ
- ERA5再解析（ECMWF; 1979–2019, 1°格子, 3時間値→日平均）。
- UKESM1-0-LL（UKESM; CMIP6, プレ産業制御, 101年, 日データ, ネイティブ解像度1.25°×1.875°→SOM解析用に2°×2°へリグリッド）。
- 変数: Z500（500 hPaジオポテンシャル高度）、MSLP（海面更正気圧）、ζ500（500 hPa相対渦度）。ERA5ではさらにPV関連（150–500 hPa鉛直平均PV: VPV、等温位面PV: IPV350/330、PV=2 PVU面のθなど）。
- 異常値の定義: 長期日平均（LTDM）をフーリエの第1–6高調波で平滑化し引き算（季節内の過度な日々変動を平滑化）。Z500・Tsurfは線形トレンド除去（空間一様の線形傾向を減算）。
- UKESMにも微小傾向の除去（制御runのスピンアップ残差対策）。

2.2 GTD（Ground Truth Dataset: 教師データ）の作成
- 対象領域: 欧州（30–75°N, 10°W–40°E; 2°格子時は北端76°N）。対象期間: JJA（6–8月）。JJAの前後4日を含め5日窓を全走査。
- 5日間の連続期間ごとに、ブロッキング高気圧の持続の有無を専門家判断でラベル付け（最小持続5日）。5日窓が1つでも該当すれば、その日に「ブロック（1）」を付与（非該当は0）。
- 目視判断に用いた情報例: Z500等値線の北方シフト、Z500・VPV異常の空間構造、等温位PV（ERA5）、UKESMではVPVが未提供のためMSLP異常を補助指標に。
- 1979–2019（ERA5）で4001個の5日窓（JJA内）を評価。UKESMでも同様に5日窓（9494個）を評価。

2.3 比較対象の従来ブロッキング指標（BI）
- AGP: Z500の緯度帯の絶対勾配（Tibaldi & Molteni 1990; Scherrer et al. 2006拡張の2次元化）。夏季の亜熱帯高を偽検出する問題に対しWoollings et al. (2018)の追加閾値で対処。
- DG83: Z500正の持続異常（Dole & Gordon, 1983）。
- S04: 150–500 hPaの鉛直平均PVの負異常（Schwierz et al., 2004; Pelly & Hoskins, 2003）。
- 閾値設定: Pinheiro et al. (2019)に従い、振幅・持続（5日以上）・面積・重なり（連日での領域連結性）。本研究では欧州領域内で閾値適用（領域端のイベントは除外）。
- 補足: PV-θ（Pelly & Hoskins, 2003）、FAWA、ハイブリッド指標（AGP+DG83）などもあるが、本研究はAGP/DG83/S04と比較。

2.4 自己組織化マップ（SOM）の概要
- SOMは入力空間（ここでは日次の気象場）の位相構造を保ったまま、代表パターン（ノード）を学習する教師なし学習。ノードはグリッド上に並び、BMU（最良一致ユニット）が逐次更新され、近傍ノードもガウス近傍関数で更新、減衰関数で収束。
- PCAのような直交基底ではなく、物理的意味を持つ連続的な状態空間を学習できる点が利点。k-meansは近傍の概念がなく、クラスタ間差を最大化しがち（大規模kでは混合的で不自然な重心を得る場合がある）。
- 実装: somoclu（Wittek et al., 2017）。

2.5 SOM-BI（SOMによるブロッキング指標）
- 手順:
  1) ERA5（またはUKESM）の日次空間場からノード数と配置（例: 3×3, 5×4など）を指定しSOMを学習。
  2) 各日をBMUにマッピング。
  3) GTDの5日窓ごとに、出現したSOMノードの組（node group）を特定。ブロック／非ブロックの教師ラベルに基づき、ブロックと強く関連する「ノード群の集合」を貪欲に加えていく（precisionの高い順）。
  4) 集合に含めるノード群の数を変化させ、Precision（P）、Recall（R）、F1=2PR/(P+R)を算出。F1が高くかつPとRの差が小さい点を最適とする。
- 注意: 単一ノードや少数ノードでは、PとRのトレードオフが強く、全体F1が劣化しやすい。ノード群（5日窓のシーケンス）で判定することが鍵。

2.6 性能評価指標
- Precision（適合率）: 真陽性 / 検出陽性
- Recall（再現率）: 真陽性 / 実際の陽性
- F1: 調和平均（PとRのバランス指標）
- 交差検証: 10分割（ERA5は4年×10fold、UKESMは10年×10fold）で汎化性能を評価。

3. 結果
3.1 事例解析（2003年・2019年欧州熱波）
- 2003年8月上旬および2019年6月下旬の熱波に対し、Z500異常、VPV（ERA5）、10 m風、SOM BMU、k-meansクラスタ（4重心）、AGP/DG83/S04のブロック領域を比較。
- 所見:
  - DG83はZ500の正偏差領域を良く追随。S04とAGPも期間前半は追随するが、2019年熱波の同定は困難。
  - SOM BMUはイベント中も複数ノードへ遷移し、単一ノードではブロックの連続的把握が難しい。一方、ノード群集合（SOM-BI）なら安定に識別できる場合が多い。
  - k-means（4重心）は粗いレジーム（例: スカンジナビア型）を捉えるが、西進等の経時的推移は十分表現できない。

3.2 ERA5/UKESMでの指標比較（GTDに対する性能）
- ERA5（1979–2019, JJA）のGTDに対するF1:
  - SOM-BI: 0.74（最良）
  - DG83: 0.73（僅差）
  - AGP: 0.56
  - S04: 0.19
  - 参考: BLO（全日ブロック）F1=0.53、RND（GTD比率に合わせたランダム）F1=0.33
- UKESM（プレ産業制御101年, JJA）のGTDに対するF1:
  - SOM-BI: 0.71（最良）
  - DG83: 0.60
  - AGP: 0.34
  - BLO: 0.45、RND: 0.29
- 含意: モデルでは総じて指標性能が低下するが、SOM-BIは相対的に高い性能を維持。閾値に依存するAGP/DG83より、空間パターンに基づくSOM-BIはモデル間適用性が高い。

3.3 ノード数・気象変数に対するSOM-BIの性能依存
- 変数別（ERA5）: Z500が最良（F1≈0.74 @ k≈20）、MSLPが次善（≈0.66）、PV系（VPV, θ-PV, IPV350/330）は総じて劣る（信号雑音比・提供状況の制約）。
- UKESMでも同様にZ500が最良（F1≈0.71 @ k≈21）。
- kが小さすぎるとUnderfit（R高・P低）、大きすぎるとOverfit（P高・R低）。PとRの差が小さくF1が高いkが適正（Z500では≈20が最適の一つ）。
- 同一kでZ500はブロック関連ノード群の数が少なく（＝物理的解釈が容易）、MSLPやPV系は多い傾向。

3.4 訓練年数に対する性能依存
- ERA5/UKESMとも、訓練年数を増やすとRとF1が漸増、Pは漸減（過学習緩和）。およそ20年で収束傾向（観測期間で十分）。
- ノード群の総数は訓練年数とともに増えるが、稀出現群が増えるだけで主性能には影響小。

3.5 クロスデータセット検証（ERA5で学習→UKESMで評価、逆も）
- Z500・k≈20–21で、ERA5↔UKESMの相互評価でもF1は各々の自己評価とほぼ同等（SOM-BIの頑健性）。
- 含意: 観測で学習→モデルに適用・比較が可能。モデルのブロッキング表現の巧拙評価や将来投影の比較に有用。

3.6 その他のハイパーパラメータ
- 5-fold vs 10-fold: わずかに10-foldが良好。
- BMU算定で正偏差のみ考慮などの変種: 全体性能への寄与は限定的。

3.7 SOM-BIの応用：タイプ分けと傾向解析（ERA5）
- Z500, k=20（最適例）で得たブロック関連ノード群（計114群）の平均コードブックを、k-meansでクラスタリング（例: k=4）。これにより、欧州の異なるブロッキング型（NW, N, E, Wなど）の代表パターンを抽出。
- 各クラスタに属する日のZ500合成、DG83によるクライマトロジーも整合的に対応。
- 傾向（1979–2019, 5年移動平均）: 発生頻度、平均持続、最大持続、イベント数を各クラスタで評価。多重検定・自己相関補正後、統計的有意性は確認されず。ただしNE/E型のイベント数増、W型の減など示唆的変化が見られる。
- 含意: SOM-BIは、従来BIでは得にくい「自動抽出されたブロッキングの型」ごとの長期変化解析を可能にする。

4. 議論と結論
- SOM-BIは、入力データの空間情報を活かし閾値依存を低減、観測・モデル双方で頑健に動作。ERA5/UKESMで従来BI（AGP/DG83/S04）より高いF1を示す。
- SOM単独ノードは「一つの天気型」を安定識別するには不十分だが、「5日窓のノード群」の集合最適化でP・Rのバランスを高められる。
- 最良の入力はZ500。学習に必要な年数は20年程度。ERA5で学習→UKESMで評価（逆も）で性能維持。
- SOM-BIはブロッキングのタイプ抽出・傾向検出にも利用価値があり、気候モデルの評価・将来変化の診断に資する。
- 制約: GTD作成は専門家判断（ドメイン端や開始・終端判断に主観性）。ただしERA5/UKESM間での性能整合により妥当性が補強された。

付録（要旨）
- UKESMの事例（2014年7月の広域熱波、2030年7月の遷移期）でも、MSLP、Z500、10 m風はERA5同様の特徴（定常高・弱風・高温極値の同時発生等）を示す。AGPはモデルでは有効度低下、DG83はZ500異常の検出に有効、SOM-BIのGTD整合は概ね良好。
- BIの空間クライマトロジー（ERA5、UKESM）を提示。k=4とk=20でのSOMとk-meansの比較も示し、SOMの位相保存と連続性の利点を確認。

コード・データ公開
- SOM-BIスクリプトおよびERA5/UKESMのGTDはZenodoで公開。
  - GTD（ERA5, 1979–2019）: https://doi.org/10.5281/zenodo.4436206
  - SOM-BIスクリプト: https://doi.org/10.5281/zenodo.4436225

主要数式
- F1スコア: F1 = 2PR / (P + R)

参考（本文内で言及された主な出典）
- Rex (1950), Dole & Gordon (1983), Tibaldi & Molteni (1990), Pelly & Hoskins (2003), Schwierz et al. (2004), Croci‑Maspoli et al. (2007), Barriopedro et al. (2010), Pinheiro et al. (2019), Woollings et al. (2018), ERA5（Hersbach et al., 2020）, UKESM（Sellar et al., 2019）ほか。
