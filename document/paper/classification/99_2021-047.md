海面更正気圧パターン分類における類似度指標の統計的相互比較
Statistical Intercomparison of Similarity Metrics in Sea Level Pressure Pattern Classification

出典情報とライセンス
- Journal of the Meteorological Society of Japan (気象集誌), 99(4), 993–1001, 2021
- DOI: 10.2151/jmsj.2021-047
- 区分: Notes and Correspondence
- 著者:
  - 佐藤拓人（筑波大学 生命環境科学研究科）
  - 日下博幸（筑波大学 計算科学研究センター）
- 原稿受理: 2021年1月26日、最終版: 2021年4月1日
- J-STAGE Advance Published: 2021年4月14日
- ライセンス: 本論文は Creative Commons Attribution 4.0 International (CC BY 4.0) ライセンスの下で公開（https://creativecommons.org/licenses/by/4.0/）

キーワード
- 類似度指標
- 天気図
- 分類

対応著者
- 日下博幸（〒305-8577 茨城県つくば市天王台1-1-1、筑波大学 計算科学研究センター）
- E-mail: kusaka@ccs.tsukuba.ac.jp

要旨（Abstract）
本研究では、天気図分類の精度向上に向け、海面更正気圧（SLP）パターン抽出における代表的な5つの類似度指標（相関係数、ユークリッド距離（EUC）、S1スコア（S1）、構造的類似度（SSIM）、アベレージハッシュ）を比較した。大量の教師データを用いて各指標の精度を統計的に評価した結果、平均値・最大値の両面で S1 と SSIM が最も高い精度を示した。これらの精度は、理想的でない教師データ（ノイズを含む）を用いた場合でも低下しなかった。さらに、S1 と SSIM は、EUC よりも主観的な類似度（見た目の類似性）を良く再現した。一方、EUC は特定例において信号の中心位置を再現した。本研究の結果は、特に非理想的な教師データを用いる場合に、SLP パターン分類に最適な類似度指標を選定するための参考となる。

1. 序論（Introduction）
天気図分類は気象学や気候学で広く用いられており、多様な分類手法が提案され、その有効性が議論されてきた（例：Huth et al. 2008）。分類手法は主観的（人手）と客観的（コンピュータ支援）に大別される。客観的手法は人間の知覚より客観性が高く、大規模データにも適用可能であるため、気候学的解析で人気が高い。代表例として、Ward 法、K-means クラスタリング、主成分分析（PCA；例：Key and Crane 1986; Cheng and Wallace 1993; Hoffmann and Schlüenzen 2013; Kato et al. 2013; Miyasaka et al. 2020）がある。さらに、自己組織化マップ（例：Hewitson and Crane 2002; Cassano et al. 2006; Johnson et al. 2008; Ohba et al. 2016; Tamaki et al. 2018）やサポートベクターマシン（例：Kimura et al. 2009; Ortiz-García et al. 2014; Su et al. 2018）などの機械学習手法も分類や選択問題に用いられている。

客観的分類の精度において、類似度指標の選択は重要であり、気象・気候分野で盛んに議論されてきた（例：Gutzler and Shukla 1984; Toth 1991; Matulla et al. 2008; Tartaglione et al. 2009; Mo et al. 2014）。Matulla et al. (2008) は、アナログ法（対象場に類似する過去データを用いる予報法）に対し、相関係数（COR）、ユークリッドノルム、S1 の3指標を比較し、最適な指標は対象変数に依存するとした。Mo et al. (2014) は、構造的類似度（SSIM）のような非伝統的指標が視覚的な類似性を捉える能力を持つことを示し、最適指標はケース（一次元か二次元か等）に依存することを示した。これらは「すべての問題・変数に通用する単一の最適指標」を定めることが難しいこと、特にノイズを含む教師データを用いる場合にどの指標が有効かが不明であることを示唆する。

本研究は、SLP パターン（特に日本海低気圧：CSoJ）選択における5つの類似度指標（COR, EUC, S1, SSIM, average hash（aHash））の選択性能を比較する。aHash は他指標と概念が異なり（詳細は 2.3 節）、その有効性評価は高速なコンピュータ支援分類法の発展に寄与しうる。さらに、ノイズの有無（非理想／理想）の両方の教師データを大量に用いる点も本稿の特徴である。現実の分類では常に理想的な教師データを用いられるとは限らない。例えば、日本海低気圧（CSoJ）の選択では、理想教師データは CSoJ のみを含むのに対し、非理想データは他擾乱や低気圧の位置ずれを含む。

2. 手法（Method）
2.1 データと対象パターン
対象は北西太平洋（120–170°E, 20–55°N）で、日本列島を含む領域の SLP マップである。JRA-55 解析（Kobayashi et al. 2015）から 2007–2016 年の 6 時間毎データを用い、水平解像度は 1.25°である。対象パターンは日本海低気圧（Cyclones over the Sea of Japan; CSoJ）である。CSoJ は日本の降雨・降雪をもたらす典型的 SLP パターンであり、分類精度の評価に有用である。CSoJ は春・冬に頻出するが、本研究では SLP マップの類似性に基づき CSoJ を選択するため、通年データを解析した。

2.2 実験設計
各類似度指標ごとに、以下のワークフロー（Fig. 3）で選択性能を評価する。
- Step 1: ラベル付きデータセットから教師データとして CSoJ マップを1つ選ぶ。
- Step 2: 選んだ教師データと、教師データを除く残りすべてのラベル付きデータとの類似度を算出する。
- Step 3: 類似度の降順（または不一致度の昇順）で並べ、ランキングリストを得る。

この手順を、全 328 枚の CSoJ マップを教師として繰り返す。ランキング上位 p 件に含まれる CSoJ の割合（選択率）を式(1)で定義し、類似度指標の選択能力を評価する。
- 選択率 Selection rate = N_selected^p / N_total^CSoJ  … (1)
  - N_total^CSoJ は教師を除くラベル付きデータに含まれる CSoJ の枚数
  - N_selected^p はランキング上位 p 件に含まれる CSoJ の枚数
p が小さく選択率が高いほど、CSoJ がランキング上位に集中しており、指標の性能が高いと解釈できる。全 328 教師データについて統計的に評価し、実用上有用な指標を同定する。

教師データの作成（主観ラベリング）
- 全 SLP マップ（14,612 枚）から著者が CSoJ 候補 839 枚を選定。非 CSoJ 候補は CSoJ 候補を除く全マップからランダムに同数抽出（Round 1）。
- 次に5名の専門家が独立に候補群を判定し、3名超が CSoJ（または非 CSoJ）と認めたものを CSoJ（328 枚）、非 CSoJ（788 枚）と確定（Round 2）。この 2 段階により、著者による選抜のみより主観バイアスが低減された。最終的に 1,116 枚を「ラベル付きデータセット」とした。

2.3 類似度指標
本研究では COR, EUC, S1, SSIM, aHash を使用する。EUC, aHash, S1 は場合により「不一致度」指標と見なされることがあるが、本研究のワークフローでは降順・昇順を切り替えることで「類似度」と等価に扱えるため、全てを「類似度指標」と総称する。

a) 相関係数（Pearson の相関係数, COR）
- 二次元 SLP を一次元ベクトルに並べ替えて算出。R ∈ [−1, 1]、1 に近いほど類似。
- 定義（Taylor 2001）:
  R = (1/N) Σ[(A_ij − Ā)(B_ij − B̄)] / (σ_A σ_B) … (2)
  - A, B は2つの SLP マップ、N は格子点数、σ は標準偏差。

b) ユークリッド距離（EUC）
- 2 つの SLP パターンを多次元ベクトルとみなし、ユークリッド距離 D を用いる。D が小さいほど類似。
- 定義:
  D = Σ_i Σ_j [A_ij − B_ij]^2 … (3)
- 空間平均値の差に強く影響されるため、空間平均が異なると見た目が似ていても適切に評価されない。本研究ではこのバイアスを避けるため、EUC のみに SLP の平年差（アノマリー）を用いた。なお、2 つのマップの空間分散を考慮すると COR と EUC の間には関係がある。

c) S1 スコア（S1）
- Teweles and Wobus (1954) による指標で、数値予報の SLP やジオポテンシャル高度の検証に広く用いられる。水平方向の勾配（圧力傾度）を考慮するのが特徴。
- S1 ≥ 0、値が小さいほど類似。
-（本文表示の式に対応する説明）x, y 方向の格子間差分（もしくは偏微分）の差 |ΔF − ΔA| の合計を、max(|ΔF|, |ΔA|) の合計で規格化して評価する（x, y の両方向を考慮）。

d) 構造的類似度（SSIM）
- Wang et al. (2004) による画像類似度指標で、輝度 l(A,B)、コントラスト c(A,B)、構造 s(A,B) の3成分で評価する。画像の部分領域ごとに計算し、全領域の平均を画像全体の類似度とする。
- 本研究では 5×5 格子の評価ウィンドウを設定し、SLP マップ全体を走査した。
- 定義:
  SSIM(A,B) = l(A,B) · c(A,B) · s(A,B)
  = [(2 μ_A μ_B + C1) / (μ_A^2 + μ_B^2 + C1)]
    · [(2 σ_A σ_B + C2) / (σ_A^2 + σ_B^2 + C2)]
    · [(σ_AB + C3) / (σ_A σ_B + C3)] … (5)
  - 本研究では C1 = C2 = C3 = 0（本文記述に従う）、μ は評価領域の平均、σ は標準偏差、σ_AB は共分散。SSIM ∈ [−1, 1]、1 に近いほど類似。

e) アベレージハッシュ（aHash）
- 画像検索で広く用いられる（Krawetz 2011; Fei et al. 2015; Haviana and Kurniadi 2016）。解像度を縮小し、画素平均値を閾値として二値化し、ビット列にハッシュ化。2 画像のビット列間のハミング距離（異なるビット数）を類似度（分離度）とする。距離が小さいほど類似。
- 本研究では 16×16 ピクセルに縮小し、256 ビットのハッシュを用いた。
- 位置づけ: COR/EUC は統計的要素（差・相関）を強調、SSIM/aHash は視覚的要素（見た目）を強調、S1 は気象学的要素（圧力傾度）を強調。これらの比較により、SLP 分類に適した指標が明らかになる。

3. 結果（Results）
要約統計（p = 327 のときの選択率の平均・最大・最小）
- p = 327 は、教師データを除く CSoJ マップ数に対応。
- 表1（本文値を転記）:
  - COR: 平均 43.0%、最大 73.1%、最小 19.6%
  - EUC: 平均 39.0%、最大 64.2%、最小 19.9%
  - aHash: 平均 40.4%、最大 66.7%、最小 15.3%
  - SSIM: 平均 56.6%、最大 77.7%、最小 26.6%
  - S1: 平均 57.5%、最大 80.4%、最小 23.5%

S1 は平均・最大の両面で最高であり、SSIM は平均で S1 とほぼ同等であった。他の3指標は選択率が低く、相互の差も小さい。最小値の比較でも平均の傾向と整合的である。5% 有意水準の Wilcoxon の順位和検定では、aHash と他の4指標の間に有意差が見られた。

選択率曲線（ランキング上位に進むほどの蓄積選択率）
- 曲線が上に凸であるほど、少数上位で CSoJ を多く選べ、指標の選択能力が高い。SSIM と S1 は、他指標に比べて上凸のケースが多く、下凸が少ない。全教師データの平均曲線（太線）も S1 と SSIM は他3指標より強い上凸を示した。

aHash の前処理（解像度縮小）の影響
- 解像度 41×29（縮小なし）、16×16、8×8 で比較した平均選択率は、それぞれ 39.3%、40.4%、40.7%。Bonferroni 補正付き多群検定（5%）では帰無仮説は棄却されず、有意差は認められなかった。
- aHash は二値化により水平方向の勾配情報が失われるため、分類性能に影響しうる。一般画像では特徴抽出に有効だが、SLP では特徴と背景の峻別が難しく、分類に重要な情報が欠落しうる。16×16 解像度で aHash と EUC を比較した平均選択率は、それぞれ 40.4%、40.0% で、有意差はなし（5% の Wilcoxon 順位和検定）。

個別例の比較（教師: 2007年3月5日06UTC）
- 教師データは CSoJ 中心が日本海北部にあり、顕著な他信号がない典型例。
- 2013年3月1日06UTC は S1=6位、EUC=3位、SSIM=9位で、視覚的類似（CSoJ の形・中心、太平洋高気圧の様相）を良く表現。
- 2007年2月14日00UTC は S1=12位、EUC=84位、SSIM=15位で、CSoJ 中心が日本海南側にあり、見た目の類似は十分でない。
- 2012年11月6日18UTC は S1=82位、EUC=14位、SSIM=76位で、中心は北側だが信号が不明瞭で、CSoJ 形状や太平洋高気圧の特徴が教師と不一致。
- 以上より、見た目の類似性の再現性は指標によって異なる。

4. 議論（Discussion）
5 指標の相互比較から、S1 と SSIM は平均・最大の選択率が最も高く、教師データにノイズがあっても性能低下が小さい。従って、既存の分類手法に S1 や SSIM を組み込むことで精度向上が期待できる。

S1 は圧力傾度（周囲格子値の差）を用いるため、SLP パターン分類において重要な水平勾配情報を評価できる。本研究の結果はこの観点を支持する。ただし、S1 が不利となる事例も報告されており（Toth 1991）、更なる検討が必要である。

SSIM は EUC や COR より高いスコアを示し、二次元画像に対する Mo et al. (2014) の結果と整合的である。SSIM は平均・コントラスト・構造の差異を総合評価し、2 つの SLP パターンの視覚的類似性を説明できるため、本研究の「見た目に似たマップの選択」に有効であった。一般画像で SSIM が平均二乗誤差より高精度であるという先行研究（Wang and Bovik 2002）とも一致する。平均二乗誤差は本研究における EUC に近い結果を与える。完全な視覚的類似性を捉える指標の決定が難しいことも示唆された。

二値化の影響について、EUC と aHash の平均選択率に有意差は見られなかったが、S1 の結果が示すように、水平勾配情報は分類で重要であり、二値化は勾配表現を失わせ性能低下につながる可能性がある。他方、信号が単純で勾配の大きさが重要でない場合には aHash が有利となる可能性もある。パターン依存性の更なる検証が必要である。

指標が強調する要素（統計・視覚・気象学）に依存して、視覚的類似の再現性が異なる。よって、選択率だけでなく、各指標の特性も考慮すべきである。

本研究の限界として、教師データに CSoJ を用いた点がある。教師が CSoJ と不一致のパターンを含む場合、結果は変化しうる。教師の信号対雑音比が高ければ、aHash のような画像簡略化に基づく手法でも高精度が得られる。PCA によるノイズ低減や次元削減などの前処理により精度改善も期待できる。空間解像度も重要であり、解像度が上がると EUC や COR の計算ベクトル次元が増し、分離度が低下しうる。

5. 結論と備考（Conclusion and remarks）
大量の教師データを用いて、COR, EUC, S1, SSIM, aHash の 5 指標の精度を評価した。SLP パターン分類において、平均精度は S1 が最良で、全教師データを用いた実験の最大精度でも S1 が最良、次点が SSIM であった。これら 2 指標は、ノイズを含む教師データを用いた場合でも、他指標より実用的分類で良好に機能する可能性が示された。aHash の精度は EUC や COR と同等であったが、解像度縮小と二値化の影響が考えられる。

本結果から、視覚的要素を強調する指標（SSIM）と、気象学的要素を強調する指標（S1）が SLP パターン分類に最も有効である。SSIM と S1 は、EUC より見た目の類似性を良く再現した。一方、EUC は CSoJ の中心位置の抽出に優れる場合があった。

将来課題として、他の典型的 SLP パターンに焦点を当てた同様の実験により、よりロバストな結論を得ること、PCA などのノイズ低減やフィルタリングの比較による分類・抽出の改善が挙げられる。

謝辞（Acknowledgments）
本研究は環境再生保全機構の環境研究総合推進費（JPMEERF20192005）の支援を受けた。共同分類に協力した5名の共同研究者、および分類試験に参加した5名の専門家に感謝する。また、西昭文博士の助言に謝意を表する。

参考文献（References）
Cassano, E. N., A. H. Lynch, J. J. Cassano, and M. R. Koslow, 2006: Classification of synoptic patterns in the western Arctic associated with extreme events at Barrow, Alaska, USA. Climate Res., 30, 83–97.
Cheng, X., and J. M. Wallace, 1993: Cluster analysis of the Northern Hemisphere wintertime 500-hPa height field: Spatial patterns. J. Atmos. Sci., 50, 2674–2696.
Fei, M., J. Li, L. Shao, Z. Ju, and G. Ouyang, 2015: Robust visual tracking based on improved perceptual hashing for robot vision. In Liu et al. (eds.), LNCS 11742, Springer, 331–340.
Gutzler, D. S., and J. Shukla, 1984: Analogs in the wintertime 500 mb height field. J. Atmos. Sci., 41, 177–189.
Haviana, S. F. C., and D. Kurniadi, 2016: Average hashing for perceptual image similarity in mobile phone application. J. Telematics Inf., 4, 12–18.
Hewitson, B. C., and R. G. Crane, 2002: Self-organizing maps: Applications to synoptic climatology. Climate Res., 22, 13–26.
Hoffmann, P., and K. H. Schlünzen, 2013: Weather pattern classification to represent the urban heat island in present and future climate. J. Appl. Meteor. Climatol., 52, 2699–2714.
Huth, R., 1996: An intercomparison of computer-assisted circulation classification methods. Int. J. Climatol., 16, 893–922.
Huth, R., et al., 2008: Classifications of atmospheric circulation patterns: Recent advances and applications. Ann. NY Acad. Sci., 1146, 105–152.
Johnson, N. C., S. B. Feldstein, and B. Tremblay, 2008: The continuum of Northern Hemisphere teleconnection patterns and a description of the NAO shift with the use of self-organizing maps. J. Climate, 21, 6354–6371.
Kato, H., Y. Nagano, and S. Tanaka, 2013: Objective classification of the sea level pressure distribution pattern in East Asia: Analysis of the cold half of the year. Geogr. Rev. Japan Series A, 86, 95–114.（日本語・英文要旨）
Key, J. R., and R. G. Crane, 1986: A comparison of synoptic classification schemes based on ‘objective’ procedures. Int. J. Climatol., 6, 375–388.
Kimura, H., H. Kawashima, H. Kusaka, and H. Kitagawa, 2009: Detection of pressure patterns using support vector machine: Winter type pressure pattern. Geogr. Rev. Japan Series A, 82, 323–331.（日本語・英文要旨）
Kobayashi, S., et al., 2015: The JRA-55 reanalysis: General specifications and basic characteristics. J. Meteor. Soc. Japan, 93, 5–48.
Krawetz, N., 2011: Looks like it. The Hacker Factor Blog. http://hackerfactor.com/blog/index.php%3F/archives/432-Looks-Like-It.html
Matulla, C., et al., 2008: Influence of similarity measures on the performance of the analog method for downscaling daily precipitation. Climate Dyn., 30, 133–144.
Miyasaka, T., et al., 2020: Future projections of heavy precipitation in Kanto and associated weather patterns using large ensemble high-resolution simulations. SOLA, 16, 125–131.
Mo, R., C. Ye, and P. H. Whitfield, 2014: Application potential of four nontraditional similarity metrics in hydrometeorology. J. Hydrometeor., 15, 1862–1880.
Ohba, M., et al., 2016: Rainfall downscaling of weekly ensemble forecasts using self-organising maps. Tellus A, 68, 29293.
Ortiz-García, E. G., S. Salcedo-Sanz, and C. Casanova-Mateo, 2014: Accurate precipitation prediction with support vector classifiers. Atmos. Res., 139, 128–136.
Raoult, B., et al., 2018: Fast retrieval of weather analogues in a multi-petabytes archive using wavelet-based fingerprints. In Shi et al. (eds.), LNCS 10861, Springer, 697–710.
Su, S.-H., et al., 2018: Identification of synoptic weather types over Taiwan area with multiple classifiers. Atmos. Sci. Lett., 19, e861.
Tamaki, Y., et al., 2018: Heavy rainfall duration bias in dynamical downscaling and its related synoptic patterns in summertime Asian monsoon. J. Appl. Meteor. Climatol., 57, 1477–1496.
Taylor, K. E., 2001: Summarizing multiple aspects of model performance in a single diagram. J. Geophys. Res., 106, 7183–7192.
Tartaglione, N., et al., 2009: Searching for resemblance between large-scale SLP patterns leading to “intense” precipitation events over Italy. Theor. Appl. Climatol., 95, 183–196.
Teweles, S., Jr., and H. B. Wobus, 1954: Verification of prognostic charts. Bull. Amer. Meteor. Soc., 35, 455–463.
Toth, Z., 1991: Intercomparison of circulation similarity measures. Mon. Wea. Rev., 119, 55–64.
Wang, Z., and A. C. Bovik, 2002: A universal image quality index. IEEE Signal Process. Lett., 9, 81–84.
Wang, Z., et al., 2004: Image quality assessment: From error visibility to structural similarity. IEEE Trans. Image Process., 13, 600–612.

図表に関する注記
本文で引用される図（例：Fig. 1–5）は PDF テキスト抽出の性質上、本ファイルには含まれていません。図の説明文（キャプション）中の情報は本文記述に基づいて反映しています。
