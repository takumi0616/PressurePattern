タイトル: 構造的類似度指標（SSIM）を用いた二段階クラスタリングによる総観循環パターンの分類とモデル評価への応用

書誌情報:
- 掲載誌: Earth System Dynamics, 15, 607–633 (2024)
- DOI: https://doi.org/10.5194/esd-15-607-2024
- ライセンス: CC BY 4.0

著者:
- Kristina Winderlich, Clementine Dalelane, Andreas Walter（Deutscher Wetterdienst, ドイツ気象局 気候・環境コンサルティング部）

対応著者: kristina.winderlich@dwd.de

要旨（日本語訳）:
本研究は、気候シミュレーションの評価手順を拡張することを目的として、総観循環パターンの新しい分類手法を開発した。本手法は地球上の任意領域・任意サイズに適用可能で、クラスタ間類似度の尺度として、従来用いられてきた距離指標に代えて修正構造的類似度指標（SSIM）を採用する点が独自である。階層的凝集型クラスタリング（HAC）とk-medoidsを反復的に組み合わせ、ユーザが事前設定する唯一のパラメータとしてSSIM閾値（2パターンの類似度の下限）だけを用いる。最終クラス数は自動的に決定される。1979–2018年のERA-Interimの500 hPa高度（z500）に適用した結果、得られたクラスは（1）入力パラメータ変化に対して整合的、（2）良好に分離、（3）空間的安定、（4）時間的安定、（5）物理的に意味のあるパターンであることを示した。さらに、CMIP6のヒストリカル実験および別の再解析へ適用し、各クラスの頻度・遷移・持続の一致性をJensen–Shannon距離で定量化し、既存の評価指標を補完する距離指標として提案する。

1. 序論
- 背景: IPCCで用いられるCMIP系の気候モデルは数が増大し、評価（品質・信頼性）手順の拡充が求められている。従来の評価はスカラー指標中心で、原因診断（総観スケールの誤差起源）に弱い。
- 目的: モデルの「総観的ふるまい」を評価に取り込み、天気型（総観循環クラス）に基づくモデル統計（頻度・遷移・持続）と参照（再解析）の統計を比較する。
- 要件: クラス分類は（i）任意領域で実施可能、（ii）クラス内同質性・クラス間差異の両立、（iii）希少パターン（極端事象に関与し得る）も包含、（iv）専門知のない領域でも自動化、が望ましい。
- 既存手法の限界: k-meansやSOM等の広く用いられる手法は、（a）ユーザがクラス数Kを事前に与える、（b）中心を平均（セントロイド）で表現し構造が希薄化、（c）MSEやユークリッド距離など構造に鈍感な距離を用いる欠点がある。

2. データ
- 合成データ: ガウス型の正負アノマリを含む22×22格子・1000枚。距離/類似度指標の挙動とアルゴリズムの性質を視覚的に検証。
- 再解析（参照）: ERA-Interim（1979–2018）、z500（12 UTC）、空間サンプリング 2°×3°（COST733推奨）。領域は欧州域（20W–???E, 29N–???; 図2参照、本文は22×22点）。
- 前処理: 季節進行による日別平均μz、標準偏差σz（各格子で年日カレンダーに沿って平滑; 151日窓）を用い、z’=(z−μz)/σzで正規化（季節差の影響を相殺）。このz’を分類に使用。
- 極端事象の紐づけ: ERA-Interimのtas, prの日別データから領域（ドイツ国内）で90百分位閾値を計算。各クラスの在位日に閾値超過の空間確率を作図。
- 追加再解析: NCEP/NCAR再解析（NCEP1）を参照に対する「下限（最良に近い）」ベンチマークとして評価。
- CMIP6: 32モデルの歴史実験（1979–2014程度、r1i1p1f1優先）。z500を用いてクラス帰属→統計→距離計算。

3. 手法
3.1 SSIMとその修正
- SSIM（構造・輝度・コントラストの三要素を考慮）:
  SSIM(x,y) = [(2μxμy+c1)(2σxy+c2)] / [(μx^2+μy^2+c1)(σx^2+σy^2+c2)]
- 混合符号（平均符号が負など）のデータに対して、原SSIMは分子・分母の符号が不安定なため、平均項の定義を修正（Mo et al., 2014のshift法の欠点を補い、平均差の感度を維持）。本研究の修正版:
  μ’x = (|μx| + |μy|)/2, μ’y = μ’x + |μx − μy|
  を用い上式のμx, μyをμ’x, μ’yに置換。c1=c2=1e−8（Baker et al. 2022に準拠）。

- 指標比較の例:
  - 合成データ: SSIMの大小が視覚的類似と整合、MSEは構造差を反映せず順位が逆転する例あり（図1）。
  - 実データz’: MSEが同じでもSSIMが大きく異なる例（SSIM=0.7 vs −0.3）を提示（図3）。

3.2 k-meansの改良検討（合成データ）
- 比較した3手法:
  - k-means + MSE: セントロイドが平滑化され構造消失（“スノーボール”クラス形成の危険、図4b）。
  - k-means + SSIM: 構造は多少保たれるが平均化で振幅が減衰（図4c）。
  - k-medoids + SSIM: クラス中心を「代表要素（メドイド）」（元データの一枚）で表現し、構造・振幅維持（図4d）。
- 結論: 構造的に意味のあるクラスを得るには「SSIM＋メドイド（k-medoids）」が適する。

3.3 二段階クラスタリング（提案手法）
- 概要: HAC（SSIM類似閾値TH_mergeでマージ）→ k-medoids（SSIMで再割当て・メドイド更新）を反復。TH_mergeのみ事前設定。クラス数は自動決定。
- 直感: TH_mergeは「人間の目で似ていると見なす下限」を模擬（例: 0.40–0.45が妥当域）。TH_merge↑→クラス数↑（類似の要求が厳しく分割が増える）/ クラス間分離はやや緩む。
- データ量と反復: 初期は各要素が単独クラス→HACで高SSIM順に結合→メドイド更新→k-medoidsで全要素の最適再配分→メドイド更新→… 類似するクラスがなくなるまで。

3.4 クラスタ評価指標
- EV（Explained Variation）= 1 − WSS/TSS（ユークリッドに基づく。相対比較のみ）。
- DRATIO = 平均内距離/平均外距離（ユークリッド。1未満が望ましい）。
- SSIM_in / SSIM_out / SSIMRATIO = クラス内平均SSIM / クラス間平均SSIM / その比（>1が分離良好）。
- 時間的安定性: データ年数を1→…→40年に増加し、さらにランダム抽出・ランダム初期化でも61通りの分類を比較。分類間の平均重み付きSSIM（mwSSIM）で安定性評価（閾値>0.40を要求）。
- 空間的安定性: 低解像（4°×6°）、高解像（1°×1.5°）でも同様のクラスが見出されるか（参照2°×3°とのSSIM）。
- 代表性: 各クラスでメドイドとセントロイドのSSIMが十分高いか（>0.60）を確認（クラス内に強い「異物」がないことの検査）。

4. 分類結果と特性
4.1 クラス数とTH_mergeの影響
- TH_merge={0.40, 0.425, 0.45}、データ量を1–40年・参照/乱択で183回実行。40年参照ではクラス数はそれぞれ37/52/89（全61分類の平均±SDは42±6 / 59±4 / 84±5）。
- 実用選択: 分析のバランス（分離・可読性・クラス内同質性）から本研究の主分析はTH_merge=0.40（37クラス）を採用。
- 37クラスの頻度: 上位6クラス（例: SP1, SP3, SP4, SP6, SP15, SP27）合計で約42%、一方で稀な10クラス合計で<5%（希少だが極端事象関与の可能性）。

4.2 クラスタの整合性（TH_merge微調整による進化）
- 1年データでTH_merge=0.40→0.425→0.45と上げると、総クラス数は31→34→39。多くのクラスは「同一」または「強類似」として引き継がれ、一部が分割・新生（図9）。小さな閾値変化に対して大局的に整合的。

4.3 クラスタ分離性（表1の要約）
- EVはクラス数増で増加（0.4476 at 0.45、0.4055 at 0.425、0.3825 at 0.40）。ランダム群はほぼ0。
- DRATIO（小さいほど良）: 0.5447 (0.45) < 0.5839 (0.425) < 0.6059 (0.40)。ただしEV/DRATIOはユークリッドであり、SSIM最適化の直接評価ではない。
- SSIMRATIO（大きいほど良）: 0.40で最大（20.58）、0.425で9.96、0.45で7.19。SSIM上の「内＞外」が最も明瞭なのは0.40。
- セントロイド間類似: メドイド間はSSIM<TH_mergeを満たす。セントロイド間は0.542が最大（強類似<0.60を満たし、望ましい分離にある）。

4.4 時間・空間安定性
- 時間: クラス数は~30年で飽和。minNYR=30年を推奨。61通りの分類間mwSSIMの最小が0.53・平均0.63（>0.40）で、データ選抜・初期化に対して安定（35年・40年でも同様）。
- 空間: 低解像・高解像でも参照クラスとSSIM平均0.53/0.52程度でマッチ（図12）。空間解像を変えても本質的なSPクラスは再現。

4.5 代表性
- 全37クラスでメドイドとセントロイドのSSIM≥0.60（平均~0.79）。構造・位置はメドイドがはっきり、セントロイドは同形でやや平滑（図13）。「スノーボール」化（異質混入）は抑制。

5. 極端事象との関係（ドイツ域でのtas/pr 90％超過確率）
- 例: SP2は全国的に降水超過高確率（南部で特に高）。SP35は高温超過が顕著。SP29は高温・多雨の双方で高超過（図14）。
- 全クラス図（補遺）: 稀少クラスの多くは高温/多雨の超過確率が高く、総観型に基づく極端事象の背景診断に有用。

6. モデル評価への応用（CMIP6）
6.1 統計の定義
- HIST（通年頻度）、季節別HIST（DJF/MAM/JJA/SON）、TRANSIT（クラス間遷移確率行列）、PERSIST（各クラスの持続確率、1–8日など）を算出。モデル・代替再解析の各日のz’を最も類似のメドイドへ帰属→統計作成。
- Jensen–Shannon距離（JS; JSDの平方根）で参照との差（分布の距離）を指標化。各統計のJSを等重み平均したmeanJSをモデルごとに算出。

6.2 結果概観
- 代替再解析NCEP1のmeanJS=0.034（下限ベンチマークに近い）。32モデルのmeanJS平均は0.113（SD=0.009）。個別統計の平均JSはTRANSIT~0.169、PERSIST~0.128、季節別HISTはJJAがやや大きい傾向（0.138）。
- 例: NorESM2-LMが最も大きいmeanJS=0.137。HadGEM3-GC31-MMやMPI-ESM1-2-LRなどが相対的に小さい（良い）meanJS~0.101–0.105。
- 可用性: JSはスカラー評価（気温・降水の平均場等）を補完し、「総観が正しいか」を別軸で点検する安全弁となる（right result for wrong reasonsの検出に寄与）。

7. 結論と展望
- SSIMとメドイドを核とする二段階クラスタリング（HAC+k-medoids）は、クラス内同質性・クラス間分離・時間空間安定性・物理的妥当性を満たし、希少パターンも取りこぼさず分類できる。
- クラスは任意領域に自動適用可能で、CMIP6評価における「総観ダイナミクスの一致度」をJensen–Shannon距離で定量化でき、従来のスカラー指標を補完する。
- 応用拡張: 変数ベクトル（z500+SLP+風等）への拡張、領域横断の準全球適用（Cannon 2020の枠組み）、天気型条件付き誤差診断（どの型で偏差が顕在化するか）など。
- 注意: 本指標は既存評価の代替ではなく補完。重み付けや合成指標（Quality Index; Sanderson et al. 2015）への統合設計が望ましい。

データ/コード:
- ERA-Interim: https://www.ecmwf.int/en/forecasts/dataset/ecmwf-reanalysis-interim
- NCEP1: https://psl.noaa.gov/data/gridded/data.ncep.reanalysis.html
- CMIP6（ESGF）: https://esgf-node.llnl.gov/search/cmip6/
- 付録/補遺: 指標の感度（Jensen–Shannon距離の例；図S2）、統計の頑健性（30年再標本化でのHIST/TRANSIT/PERSISTのSD検討）

主要文献:
- Wang & Bovik (2009): MSEの限界とSSIMの優位性
- Wang et al. (2004): SSIMの提案
- Baker et al. (2022): 浮動小数点データのSSIM（DSSIM）
- Mo et al. (2014): SSIMの水文気象への適用と修正
- Schubert & Rousseeuw (2021): k-medoidsの高速化・特性
- COST733（Tveito et al., 2016）: 天気型分類の総覧
- Cannon (2020): CMIP世代間の循環バイアス低減の検証
- Fabiano et al. (2020), Hochman et al. (2021) 他: ヨーロッパの気団・レジーム

謝辞・競合:
- ECMWF/NCEPのデータ利用。査読対応・編集: G. Messori。競合なし（著者申告）。出版社注（地理名称・表記等の中立性）。
