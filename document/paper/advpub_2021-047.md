# 海面更正気圧（SLP）パターン分類における類似度指標の統計相互比較

本ファイルは PDF から抽出した本文を、日本語でできる限り正確に翻訳・整形したものです。PDF の性質上、数式や一部の記号・レイアウトに崩れや文字化けが見られる箇所があります。該当箇所は原文記法を可能な限り保持するか、注記を付しています。内容の削除は行っていません。

— 早期オンライン公開（EARLY ONLINE RELEASE）情報 —

- 本稿は査読済み・受理済みの原稿であり、最終出版版では体裁・校正等が異なる可能性があります。
- 本原稿は Creative Commons Attribution 4.0 International (CC BY 4.0) ライセンスの下でダウンロード・配布・利用可能です。
- 引用の際は DOI を用いてください。DOI: 10.2151/jmsj.2021-047
- J-STAGE 先行公開日: 2021 年 4 月 29 日
- 最終版公開後は上記 DOI の先行版が置き換えられます。

論文タイトル: Statistical Intercomparison of Similarity Metrics in Sea Level Pressure Pattern Classification  
著者: Takuto SATO（筑波大学 生命環境科学研究群）; Hiroyuki KUSAKA（筑波大学 計算科学研究センター、責任著者）  
提出日: 2021 年 1 月 25 日  
連絡先: kusaka@ccs.tsukuba.ac.jp, +81-29-853-6481

---

要旨（Abstract）

本研究は、気象図の正確な分類のために SLP パターンを抽出する際の代表的な 5 種類の類似度指標、すなわち相関係数（COR）、ユークリッド距離（EUC）、S1 スコア（S1）、構造類似度（SSIM）、平均ハッシュ（aHash）の精度を比較する。多数の教師データを用いて各指標の精度を統計的に評価した。その結果、S1 と SSIM は平均値・最大値の両面で最も高い精度を示し、非理想（ノイズを含む）教師データを用いた場合にも精度は低下しないことが分かった。加えて、S1 と SSIM は、EUC と比べて 2 枚の図の主観的な類似性をよりよく再現する。一方で、EUC はサンプルケースにおいてシグナルの中心位置を再現する。本研究は、特に非理想な教師データを用いる場合に、SLP パターン分類に最も有用な類似度指標の選定に資する。

キーワード: 類似度指標; 天気図; 分類

---

1. 序論（Introduction）

天気図分類は気象学・気候学で広く用いられており、多様な分類手法が提案され有効性が議論されてきた（例: Huth et al., 2008）。分類手法は主観的または客観的（計算機支援）に大別される。計算機支援の分類は人間の知覚より客観的で、大規模データセットに適用可能なため、気候解析で広く用いられる。代表的手法には、Ward 法、k-means クラスタリング、主成分分析（PCA）（例: Key and Crane, 1986; Cheng and Wallace, 1993; Hoffmann and Schlünzen, 2013; Kato et al., 2013; Miyasaka et al., 2020）がある。自己組織化マップ（SOM; 例: Hewitson and Crane, 2002; Cassano et al., 2006; Johnson et al., 2008; Ohba et al., 2016; Tamaki et al., 2018）やサポートベクタマシン（SVM; 例: Kimura et al., 2009; Ortiz-García et al., 2014; Su et al., 2018）などの機械学習手法も分類や選択問題に用いられている。

客観分類の高精度化には類似度指標が重要である。このため、気象・気候学において類似度指標の精度は広く議論されてきた（例: Gutzler and Shukla, 1984; Toth, 1991; Matulla et al., 2008; Tartaglione et al., 2009; Mo et al., 2014）。Matulla et al. (2008) は相関係数（COR）、ユークリッドノルム、S1 スコア（S1）の 3 指標をアナログ法（対象場に類似した履歴データを用いる予報法）に対して評価し、最適な指標がアナログ法の対象変数に依存することを示した。Mo et al. (2014) は構造類似度（SSIM）など非伝統的指標の視覚的類似性の捉え方を検討し、最適指標がケース（一次元・二次元パターン等）に依存することを示した。これらは、すべての問題・変数に普遍的に適用できる単一の指標の同定が難しいこと、特にノイズを含む教師データを用いる場合にどの指標が有効か不明確であることを示唆する。

本研究では、SLP パターン（Sea of Japan 上の低気圧: CSoJ）選択における 5 指標（COR, EUC, S1, SSIM, aHash）の精度を比較する。aHash は他指標と異なる概念に基づき（詳細は 2.3 節）、その有効性の評価は迅速な計算機支援分類手法の発展に貢献する。さらに本研究の独自性として、ノイズの有無（非理想・理想）双方の大規模な教師データセットを用いる。実際の分類では、必ずしも理想的教師データが用意できない。例えば、日本海低気圧（CSoJ）選択では、理想データは CSoJ のみを含み他擾乱を含まないが、非理想データは他擾乱や低気圧のシフトを含む。

---

2. 方法（Method）

2.1 データと対象パターン（Data and Target Pattern）

対象は日本列島周辺の北西太平洋（120–170°E, 20–55°N）の SLP マップ。JRA-55（Kobayashi et al., 2015）再解析データを用い、2007–2016 年の 6 時間毎、水平解像度 1.25°。対象パターンは日本海上の低気圧（CSoJ）である（図 1 例）。この例は日本の降雨・降雪をもたらす典型的 SLP パターンであり、分類精度の議論に有用。CSoJ は春・冬に頻出するが、本研究では SLP マップの類似性に着目して通年を解析した。

類似度計算前に、CSoJ と非 CSoJ の主観ラベリング（図 2）を実施。まず著者が全 SLP マップ（14,612 枚）から CSoJ 候補 839 枚を選別し、同数の非 CSoJ 候補をランダム抽出（Round 1）。次に 5 名の専門家が独立に CSoJ/非 CSoJ 候補をチェックし、3 名以上が CSoJ/非 CSoJ と認定したものをそれぞれ CSoJ 328 枚、非 CSoJ 788 枚とした（Round 2）。この 2 段階により、著者の主観バイアスの影響が相対的に小さくなる。結果、実験用のラベル付きデータセットは 1,116 枚となった。

2.2 実験設計（Experimental Design）

類似度指標の性能は、各指標ごとに以下のワークフロー（図 3）で評価する。  
(1) ラベル付きデータセットから教師 CSoJ を 1 枚選択。  
(2) 教師データと、教師を除く全データとの類似度を計算。  
(3) 類似度の降順に並べ、ランキングリストを作成。  
この手順を、全 328 個の CSoJ を教師として繰り返す。ランキングから選択率（Selection rate）を式 (1) で算出し、類似度指標の選択能力を評価する。

選択率の定義（原文記法のまま掲示、記号は PDF 抽出により一部体裁崩れ）:

```
Selection rate = N_CSoJ(top-p) / N_CSoJ(excluding teacher)                      (1)
```

- N_CSoJ(excluding teacher): 教師データを除くラベル付きデータ内の CSoJ 数
- N_CSoJ(top-p): ランキング上位 p 個内に含まれる CSoJ 数  
  p が小さく選択率が高いほど、CSoJ がリスト上位に集中し、指標性能が高いと解釈できる。

5 指標の性能は、Huth (1996) における resemble 法のように、同一グループ内の CSoJ 枚数を数える観点でも評価する。全 328 教師について統計的に評価し、実用分類に有用な指標を判定する。

2.3 類似度指標（Similarity metrics）

用いた指標は COR, EUC, S1, SSIM, aHash の 5 種。EUC, aHash, S1 は文献により「非類似度」とも見なされるが、本研究のランキング手順（降順/昇順）上は同義のため、便宜上「類似度指標」と総称する。

(a) 相関係数（Pearson の相関係数, COR）  
2 次元 SLP を 1 次元ベクトルに展開して相関 R を計算（Taylor, 2001）。R∈[−1,1]、1 に近いほど類似。

原文表式（抽出再掲）:

```
R = (1/N) Σ_i [(A_i - Ā)/σ_A] [(B_i - B̄)/σ_B]                                 (2)
```

A, B は 2 つの SLP マップ、N は格子点数、σ は標準偏差。

(b) ユークリッド距離（EUC）  
2 次元 SLP を多次元ベクトルとみなし、距離 D を

```
D = sqrt( Σ_i Σ_j (A(i,j) - B(i,j))^2 )                                         (3)
```

で定義。小さいほど類似。EUC は空間平均に強く影響されるため、本研究では偏りを避けるため EUC のみ SLP から空間アノマリ（偏差）を用いた。空間分散を考慮すると COR と EUC には関連がある。

(c) S1 スコア（S1）  
Teweles and Wobus (1954) により提案。水平方向の勾配情報を用いるため、数値予報出力の SLP や高度場の検証に用いられる指標。S1≥0、値が小さいほど類似。原文表式（抽出の都合で一部記号が化けているため原式の構造のみ示す）:

```
S1 = 100 * [ Σ |∂x D| + |∂y D| ] / [ Σ ( |∂x F| + |∂x A| ) + ( |∂y F| + |∂y A| ) ]   (4)
```

ここで、∂x, ∂y は x, y 方向の差分（勾配）、F はデータセット、A は教師、D は両者の差。本文では F をデータ、A を教師、D を差と解釈。

(d) 構造類似度（SSIM）  
Wang et al. (2004) により提案。輝度差 l(A,B)、コントラスト差 c(A,B)、構造差 s(A,B) を用い、画像全体の SSIM を評価領域の平均として求める。本研究では 5×5 グリッドの評価領域を走査。原文表式（抽出再掲、C1=C2=C3=0 とされている点は原文準拠だが、一般には微小定数が用いられるため注意）:

```
S(A,B) = l(A,B) * c(A,B) * s(A,B)
       = [(2 μ_A μ_B) / (μ_A^2 + μ_B^2)] * [(2 σ_A σ_B) / (σ_A^2 + σ_B^2)] * [(σ_AB) / (σ_A σ_B)]   (5)
```

S∈[−1,1]、1 に近いほど類似。

(e) 平均ハッシュ（Average Hash, aHash）  
主に画像検索で用いられる（Krawetz, 2011; Fei et al., 2015; Haviana and Kurniadi, 2016）。対象画像の解像度を所定サイズに縮約し、平均値を閾値に 1/0 のビット列にハッシュ化。2 画像のハミング距離（ビット差数）を類似度（分離度）とする。距離が小さいほど類似（同一ビット列）。本研究では 16×16 に縮約し 256 ビットにハッシュ化。EUC と COR は統計的要素（差・相関）を強調、SSIM と aHash は視覚要素（視覚的・知覚的類似）を強調、S1 は気象要素（圧力勾配）を強調する。これらの相互比較により、SLP マップ分類に有利な指標が明らかになる。

---

3. 結果（Results）

p=327（教師を除く CSoJ 327 枚を上位から見る）の平均・最大・最小の選択率を表 1 に示す。S1 は平均・最大ともに最高のスコア、SSIM は平均で S1 にほぼ匹敵。他 3 指標は選択率が低く、相互差も大きくない。最小選択率も平均と同様の傾向。5 指標に対して有意水準 5% の Wilcoxon の順位和検定を独立に実施し、aHash と他 4 指標の間に有意差が認められた。

図 4 は選択データ数と選択率の関係。上に凸の曲線ほど p が小さくても CSoJ を選べており高精度。SSIM と S1 は他指標に比べて上に凸の曲線が多く、下に凸が少ない。全教師データに対する平均曲線（太線）も S1 と SSIM が他 3 指標より強い上方凸を示す。

aHash は前処理で画像解像度を落として高周波成分を除去するが、解像度低下は精度に影響しうる。影響評価として、41×29（縮約なし）・16×16・8×8 の 3 解像度で選択率を比較し、平均選択率はそれぞれ 39.3%、40.4%、40.7%。多群比較（Bonferroni 補正を用いた Wilcoxon）では帰無仮説は棄却されなかった。

aHash は二値化により水平勾配情報を失うため、その影響も検討した。一般画像では特徴抽出の観点からハッシュ化が有効だが、SLP パターンでは特徴と背景の区別が難しく、重要情報が失われ精度が落ちる可能性がある。16×16 解像度での aHash と EUC の比較では、全 328 教師の平均選択率は aHash 40.4%、EUC 40.0% であり、有意差は認められなかった（5% 水準の Wilcoxon）。

図 5 は 2007/03/05 06UTC のマップを教師とした例の抽出結果。教師では CSoJ 中心が日本海北部に位置し他顕著シグナルなし。2013/03/01 06UTC のマップは 3 指標で高順位（S1: 6 位, EUC: 3 位, SSIM: 9 位）で視覚的類似性が高い。2007/02/14 00UTC は S1 と SSIM で高順位（S1:12 位, EUC:84 位, SSIM:15 位）だが、CSoJ 中心は日本海南側。2012/11/06 18UTC は EUC で高順位（S1:82 位, EUC:14 位, SSIM:76 位）で、中心は日本海北側だがシグナルが不明瞭で形状や太平洋側高気圧の出方も教師と異なる。すなわち、順位は指標に依存し、視覚的類似の再現性も指標依存である。

---

4. 議論（Discussion）

5 指標の相互比較により、S1 と SSIM は平均・最大選択率で最高精度を示し、性能低下もしにくい。ゆえに、S1 と SSIM を併用することで既存分類手法の精度改善が期待できる。S1 は水平圧力勾配を考慮し、SLP パターン分類で重要な格子間の差（勾配）情報を取り入れる。本研究はこの観点を支持する。ただし S1 はケースにより性能低下も報告されており（Toth, 1991）、さらなる検討が必要である。

SSIM も S1 に匹敵する高スコアであり、二次元画像において SSIM が EUC や COR を上回る結果は Mo et al. (2014) と整合する。SSIM は平均・コントラスト・構造の差異を総合し、視覚的類似を説明する。一般画像で SSIM が MSE より高精度であること（Wang and Bovik, 2002）とも符合する。これは、視覚的類似を完全に捉える指標の同定の難しさを示す。

二値化の影響については、EUC と aHash の平均選択率に差が見られず、二値化は分類上有効とは限らない。S1 の結果が示すように、SLP 分類では水平勾配情報が重要で、二値化により情報が失われると性能が低下しうる。一方、シグナルが単純で勾配の大きさが重要でない場合には aHash が他手法より正確な可能性もあり、様々なパターンでの検証が必要である。

また、各指標が強調する要素の違いが視覚的類似にどう影響するかの議論は、精度改善の示唆を与える。例えば、全指標で高順位の例は視覚的にも類似しているが、S1・SSIM で高順位かつ EUC で低順位の例では中心位置がやや異なる一方で全体の視覚的類似は高い。EUC で高順位の例は全体パターンが教師と整合しない場合もある。したがって、選択率のみならず各指標の特性を考慮する必要がある。

本研究の限界として、教師データは CSoJ パターンに属する SLP マップを用いたが、CSoJ と不整合な教師データの使用は結果を変えうる。これは教師パターンの信号対雑音比の違いによる。信号が明瞭なら aHash のような簡略化手法でも高精度が得られうる。同様に、PCA 等の前処理（ノイズ除去・次元削減）で性能向上も見込まれる。空間解像度も重要で、解像度が上がると EUC・COR の計算次元が増し分離度が低下する可能性がある。

---

5. 結論と注記（Conclusion and remarks）

多数の教師データを用いて COR, EUC, S1, SSIM, aHash の 5 指標の精度を評価した。平均精度・最大精度の双方で S1 が最良、次点は SSIM であった。すなわち、ノイズの多い教師データでも S1 と SSIM は実用的分類問題で他指標より優れる可能性がある。aHash の精度は EUC や COR と同程度で、aHash の解像度縮約・二値化が影響していると考えられる。総じて、視覚因子（SSIM）と気象因子（S1）を強調する指標が SLP パターンの抽出に有用で、EUC より視覚的類似を良好に再現した。一方で EUC は CSoJ の中心位置抽出に寄与した。将来課題として、他の典型的 SLP パターンに焦点を当てた同様の実験、および PCA やフィルタ等のノイズ低減の比較が挙げられる。

---

謝辞（Acknowledgments）

本研究は、環境再生保全機構の環境研究総合推進費（JPMEERF20192005）の支援を受けた。共同分類に協力いただいた 5 名の共同研究者、分類試験に参加いただいた 5 名の専門家に感謝する。助言を頂いた西昭文博士にも謝意を表する。

---

参考文献（References）

Cassano, E. N., et al., 2006: Classification of synoptic patterns in the western Arctic... Climate Res., 30, 83–97.  
Cheng, X., and J. M. Wallace, 1993: Cluster analysis of the Northern Hemisphere... J. Atmos. Sci., 50, 2674–2696.  
Fei, M., et al., 2015: Robust visual tracking based on improved perceptual hashing... Springer, 331–340.  
Gutzler, D. S., and J. Shukla, 1984: Analogs in the wintertime 500 mb height field. J. Atmos. Sci., 41, 177–189.  
Haviana, S. F. C., and D. Kurniadi, 2016: Average hashing for perceptual image similarity... J. Telematics Inf., 4, 12–18.  
Hewitson, B. C., and R. G. Crane, 2002: Self-organizing maps... Climate Res., 22, 13–26.  
Hoffmann, P., and K. H. Schlünzen, 2013: Weather pattern classification... J. Appl. Meteor. Climatol., 52, 2699–2714.  
Huth, R., 1996: An intercomparison of computer-assisted circulation classification methods. Int. J. Climatol., 16, 893–922.  
Huth, R., et al., 2008: Classifications of atmospheric circulation patterns... Ann. NY Acad. Sci., 1146, 105–152.  
Johnson, N. C., et al., 2008: ... NAO shift with SOMs. J. Climate, 21, 6354–6371.  
Kato, H., et al., 2013: ... East Asia... Geogr. Rev. Japan Series A, 86, 95–114 (in Japanese).  
Key, J. R., and R. G. Crane, 1986: Objective synoptic classification schemes... Int. J. Climatol., 6, 375–388.  
Kimura, H., et al., 2009: Detection of pressure patterns using SVM... Geogr. Rev. Japan Series A, 82, 323–331 (in Japanese).  
Kobayashi, S., et al., 2015: The JRA-55 reanalysis... JMSJ, 93, 5–48.  
Krawetz, N., 2011: Looks like it. http://hackerfactor.com/blog/index.php%3F/archives/432-Looks-Like-It.html  
Matulla, C., et al., 2008: Influence of similarity measures... Climate Dyn., 30, 133–144.  
Miyasaka, T., et al., 2020: ... Kanto and associated weather patterns... SOLA, 16, 125–131.  
Mo, R., et al., 2014: Four nontraditional similarity metrics in hydrometeorology. J. Hydrometeor., 15, 1862–1880.  
Ohba, M., et al., 2016: Rainfall downscaling using SOMs. Tellus A, 68, 29293.  
Ortiz-García, E. G., et al., 2014: Accurate precipitation prediction with SVC... Atmos. Res., 139, 128–136.  
Raoult, B., et al., 2018: Fast retrieval of weather analogues... Springer, 697–710.  
Su, S.-H., et al., 2018: Synoptic weather types over Taiwan... Atmos. Sci. Lett., 19, e861.  
Tamaki, Y., et al., 2018: Heavy rainfall duration bias... J. Appl. Meteor. Climatol., 57, 1477–1496.  
Taylor, K. E., 2001: Summarizing multiple aspects... J. Geophys. Res., 106, 7183–7192.  
Tartaglione, N., et al., 2009: Resemblance between SLP patterns... Theor. Appl. Climatol., 95, 183–196.  
Teweles Jr., S., and H. B. Wobus, 1954: Verification of prognostic charts. BAMS, 35, 455–463.  
Toth, Z., 1991: Intercomparison of circulation similarity measures. Mon. Wea. Rev., 119, 55–64.  
Wang, Z., and A. C. Bovik, 2002: A universal image quality index. IEEE SPL, 9, 81–84.  
Wang, Z., et al., 2004: From error visibility to structural similarity. IEEE TIP, 13, 600–612.

---

表 1（各類似度指標の平均・最大・最小の選択率（%）；p=327）

| 指標  | 平均 | 最大 | 最小 |
| ----- | ---: | ---: | ---: |
| COR   | 43.0 | 73.1 | 19.6 |
| EUC   | 39.0 | 64.2 | 19.9 |
| aHash | 40.4 | 66.7 | 15.3 |
| SSIM  | 56.6 | 77.7 | 26.6 |
| S1    | 57.5 | 80.4 | 23.5 |

注: 選択率は、ランキング上位 327（教師除く CSoJ 数）に含まれる CSoJ の比率（式(1)）を表す。

---

図の一覧（List of Figures）

- 図 1: CSoJ パターンの天気図例（2007 年 3 月 5 日 12UTC）。
- 図 2: 主観ラベリング過程の概略。
- 図 3: ワークフロー概要図。
- 図 4: 類似度指標ごとの選択率曲線（グレー: 各教師、黒太線: 平均、急な点線: 理想、緩やかな点線: ランダム）。
- 図 5: 教師と抽出された SLP パターン（hPa）。各図上の数値は各指標における順位（小さいほど教師に類似）。

図注（出典表示等）

- 図 1: 気象庁「天気図」を基に国立情報学研究所「デジタル台風」が作成。

（画像は PDF からの抽出が困難なため、キャプション・説明文のみを記載）
