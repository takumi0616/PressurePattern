---
title: "エッジ検出への計算論的アプローチ"
author: "John Francis Canny"
source: "IEEE Transactions on Pattern Analysis and Machine Intelligence, Vol. PAMI-8, No. 6, November 1986"
doi: "10.1109/TPAMI.1986.4767851"
---

要旨（Abstract）
本論文はエッジ検出に対する計算論的アプローチを記述する。このアプローチの成否は、エッジ点の計算に対して包括的な目標集合を定義することに依存する。目標は、解の形に関して最小限の仮定のもとで、検出器に期待する挙動を厳密に規定できる程度に精密でなければならない。本稿では、あるクラスのエッジに対する検出（detection）および位置特定（localization）の基準を定義し、演算子のインパルス応答に対する汎関数としてこれらの基準の数学的形式を与える。さらに単一のエッジに対する応答が一つであることを保証する第三の基準を追加する。これらの基準を数値最適化に用い、ステップエッジを含むいくつかの一般的な画像特徴に対する検出器を導出する。ステップエッジに特化すると、主目標である検出性能と位置特定性能の間に自然な不確定性原理（トレードオフ）が存在することが分かる。この原理により、任意のスケールで最適となる単一の演算子形状が導かれる。この最適検出器は、ガウス平滑化画像の勾配強度の極大でエッジを標示する簡易近似実装を持つ。さらに、画像の様々なSNRに対処するために複数幅の演算子を用いる拡張、および異なるスケールからの情報を粗から細へ統合する一般手法「特徴合成（feature synthesis）」を提示する。最後に、演算子の点拡がり関数をエッジに沿って延長するとステップエッジ検出性能が大幅に向上することを示す。この検出スキームでは各点で複数の伸長演算子を用い、方向性のある演算子出力を勾配極大検出器と統合する。

索引語：エッジ検出，特徴抽出，画像処理，機械視覚，多重スケール画像解析


I. 序論（Introduction）
エッジ検出器、特にステップエッジ検出器は、多くのコンピュータビジョンシステムに不可欠である。エッジ検出は、処理すべきデータ量を劇的に削減すると同時に、物体境界に関する有用な構造情報を保存することで、画像解析を単純化する。用途は多様だが、多くの応用に共通する要求が存在し、それを抽象化したエッジ検出問題の解は様々なドメインに適用できる。

具体例として：Binford-Horn のラインファインダ[14]はエッジ検出器の出力を幾何学的立体を抽出するプログラムに入力した。モデルベース視覚システム ACRONYM[3]は、高度な認識プログラムの前段としてエッジ検出を用いた。Shape from motion[29][13]は、画像平面におけるエッジ輪郭やエッジ点の運動から3次元構造を推定する。ステレオ視[19][20]でも、マッチング前の前処理としてエッジ検出を仮定する理論がある。Beattie[1]は低レベル画像理解のためのエッジベースのラベリングを記述した。さらに輪郭から形状[27]やテクスチャから形状[31]など、輪郭を用いて3次元情報を抽出する方法も提案されている。

上記の例には、エッジ検出性能に関する共通の基準がある。第一に低い誤り率である。画像に存在するエッジを取りこぼさず、偽反応がないことが重要である。第二に良好な位置特定である。標示されたエッジ点が真のエッジの「中心」にできるだけ近くなるべきである。これはステレオや運動からの形状において特に重要である。本稿では、任意のエッジに対して適用可能なこれら二つの基準の数学形式を導き、設計に用いる。さらに、単一のエッジに対する多重反応を避ける第三の基準が必要であることを示す。数値最適化により、リッジやルーフなど数種類の一元的エッジに対する最適演算子を得る。ステップエッジに特化した解析では、検出と位置特定の間に不確定性原理が存在し、一つの独自な（スケールで伸縮する）インパルス応答形状が最適であることを示す。実験では、ガウス平滑画像の勾配強度極大にエッジを標示する近似実装と、異なるSNRに対処するための複数幅運用、スケール間統合のための特徴合成を提示する。また、エッジ方向に沿って演算子の点拡がりを延長する（方向性・伸長演算子を用いる）ことで性能が向上することを示す。


II. 一次元定式化（One-Dimensional Formulation）
解析を容易にするため、まず一次元エッジプロファイルを考える。エッジは局所的にある方向で一定断面を持つと仮定する（平滑な輪郭やリッジに当てはまる）。画像はエッジと加法性白色ガウス雑音の和とする。

検出問題の定式化：既知の断面を持つエッジに白色ガウス雑音が加わった信号（例：ステップエッジ）を、インパルス応答 f(x) のフィルタで畳み込み、出力の局所最大でエッジ中心を標示する。設計問題は、以下の性能基準を最大化するフィルタ f を求めることに帰着する。

性能基準：
1) 良好な検出（Good detection）：真のエッジ点の見逃し確率と非エッジ点の誤標示確率が低いこと。両者は出力SNRの単調減少関数なので、SNR の最大化に相当。
2) 良好な位置特定（Good localization）：標示されたエッジ点が真のエッジ中心にできるだけ近いこと。
3) 単一エッジに単一応答（Only one response to a single edge）：一つのエッジに対して応答は一つであること。第1基準の数学形式には多重応答の抑制が含まれないため、明示的に制約として追加する。

記法：インパルス応答を f(x)、エッジ形状を G(x) とし、エッジ中心を x=0 とする。エッジ応答は
HG = ∫_{-W}^{+W} G(-x) f(x) dx
とする。雑音 n(x) に対する出力の二乗平均は
E[H_n(x0)^2] = n_0^2 ∫_{-W}^{+W} f'^2(x) dx
（導出の過程で、局所最大条件 H'_n(x0) + H'_G(x0) = 0、Taylor 展開、対称性等を用いる）。位置ずれ x0 の分散近似から、位置特定指標は 1/σ_x0 に対応する。

SNR は
SNR = |∫ G(-x) f(x) dx| / ( n_0 (∫ f^2(x) dx)^{1/2} )

位置特定は
Localization = |∫ G'(-x) f'(x) dx| / ( n_0 (∫ f'^2(x) dx)^{1/2} )

両者の同時最大化のため、これらの積の最大化を考える（任意の単調結合でもよいが、後の解析が簡潔になる）。ただし後述の多重応答制約も課す。

多重応答の排除：SNR と位置特定だけを最大化すると、例えばステップエッジでは「ボックス差分（差分箱）演算子」が最適になるが、帯域が広く、雑音やテクスチャで多数の局所極大を生むため、単一エッジ近傍でピークが多数生じる問題がある。これを避けるため、雑音応答の極大間隔を演算子幅 W の一定比 k に保つという制約を課す。Rice[24] の結果を用いると、f' のゼロ交差間隔の平均 x_zc は
x_zc(f) = ( ∫ f'^2 / ∫ f''^2 )^{1/2}
で与えられ、雑音ピーク間隔 X_max = 2 x_zc(f) = k W を制約とする。これは空間スケーリングに関して不変である。


III. 数値最適化による最適検出器の導出（Finding Optimal Detectors by Numerical Optimization）
一般に、制約付きで積基準を最大化する f の閉形式解は困難である。f を離散インパルス応答として扱えば、必要なのは少数の内積計算で、数値最適化で直接求められる。制約はペナルティ法[15]で扱える。

この手法をリッジとルーフの一次元プロフィールに適用した例を示す（図2, 図3）。制約には上述の多重応答制約と DC 応答ゼロ（定数入力に対して出力ゼロ）が含まれる。広いリッジは2本の近接エッジとみなせるため、狭いエッジ検出器で対処可能な場合も多い。実装上は、最も狭いエッジ検出器で拾えない、1〜2ピクセル幅の非常に狭いリッジ（傷や印刷など）対処にリッジ検出器が有効となる。ルーフ検出器は理想的なルーフが稀であるため実装には含めないが、リッジ検出器が近似として十分なことが多い。


IV. ステップエッジ用検出器（A Detector for Step Edges）
エッジ形状をステップ G(x) とし、検出と位置特定基準を f のみに依存する形に正規化する。空間スケーリング f_w(x)=f(x/w) を考えると、SNR 指標 E(f) は w 倍、位置特定 A(f) は 1/w 倍にスケールする。したがって両者の積はスケール不変である。この結果から、SNR を一定に保って位置特定を最大にする f はスケール変換で族を成し、ステップエッジ検出器の最適形状はスケールに関して一意である。

汎関数の積最大化を、連続の等周（isoperimetric）制約下での単一積分の極値問題に変換し、ラグランジュ乗数を用いてオイラー方程式を立てる。境界条件（f(0)=0, f(-W)=0, f'(0)=s, f'(-W)=0）を課し、二次変分の正定性から解の根が複素数（±(α±iω)）になる条件（4λ2 > λ1）を導く。一般解は指数×正弦/余弦の線形結合＋定数で与えられ、境界条件から係数が α, ω, 定数比 β で表現される。残る非線形最適化（多重応答制約を満たしつつ積基準を最大化）は数値的に解く。

多重応答制約の厳しさ（隣接ピーク間隔）により f の形が変化する（図5）。数値的に得られた最良のフィルタ群のパラメータと性能指標（E·A の積、r=|f'(0)|/σ_s 比）は図4に示す。厳格な制約下で得られた代表的なフィルタ（表中 #6）は、後述の「ガウシアン一次微分」による近似で効率良く実装できる。なお、制約をやや緩めれば E·A をさらに改善できる可能性がある（例：#4,#5）。


V. 効率的近似（An Efficient Approximation）
前節の最適ステップエッジ検出器（図6(a)）は、ガウシアン G の一次微分 G'(x)（図6(b)）で近似できる：
G(x)=exp(-x^2/(2σ^2)), f(x) = (x/σ^2) exp(-x^2/(2σ^2))

この近似は2次元拡張の計算効率が非常に高い利点がある。理論的性能比較では、E·A の積は最適より約20%低く、r は約10%劣るが、実画像での差異は小さいことが多く、計算効率から一次微分ガウスを実験で採用した。Macleod[16] の提案（2つの平行移動ガウスの差）や Marr-Hildreth[18] のLoG（ラプラシアン・オブ・ガウシアン）との関係にも言及する。一次元では両者はほぼ等価だが、二次元では方向性を持つ本検出器の方が局在と検出に優れる。しきい値処理には適応的ヒステリシスが有効であり、次節で述べる。


VI. 雑音推定としきい値処理（Noise Estimation and Thresholding）
演算子出力から雑音成分を推定するため、ウィーナーフィルタを用いた最適推定を適用する。成分（雑音出力 g1、エッジ応答 g2）が無相関であると仮定し、自己相関 R11, R22 に基づき最適フィルタ K を求め、演算子出力に畳み込み、結果を二乗して局所的な雑音エネルギ推定を得る。単純平均はエッジ密度に左右されやすいため、全体ヒストグラムの低パーセンタイル（例：80%以下）から雑音強度を推定する方法が有効である。

しきい値は一つだけだとストリーキング（輪郭の分断）が起こりやすい。これを避けるため、二つのしきい値によるヒステリシスしきい値を用いる。高しきい値を超える点と、それに連結し低しきい値以上の点をすべて出力する。これにより分断と孤立誤検出が大幅に低減される。高低比は2〜3倍程度が有効である（図7）。


VII. 二次元以上への拡張（Two or More Dimensions）
二次元ではエッジは位置に加えて方向（エッジ接線方向）を持つ。任意方向 n におけるガウスの一次微分 G_n = ∂/∂n (G*I) を用いると、局所最大は
∂^2/∂n^2 (G*I) = 0
で与えられる（方向 n での二次微分のゼロ交差）。最大値の強度は |∇(G*I)| に等しい。よって、まず等方ガウスで平滑化し、その後に方向二次微分のゼロ交差を取ることで、方向性演算子の適用と等価にエッジ位置を決め、強度は勾配大きさで得られる（畳み込みの結合則による）。この非線形二次微分形式は Torre-Poggio[28] や Haralick[10] にも見られ、Prewitt[23] は強調の文脈で議論する。

二次元LoGは二つの直交方向の二次微分に分解できるが、エッジ方向に沿う成分は検出・局在に寄与せず雑音のみ増やす。したがって、方向性を持つ演算子の方が有利な場合が多い。実装上は、最小の（非伸長）演算子で十分な場合が多いが、後述のようにエッジ方向に沿って伸長（投影）した演算子は局在・検出ともに改善をもたらす。


VIII. 複数幅の必要性（The Need for Multiple Widths）
画像内でのSNRはエッジごとに異なるため、複数スケール（複数σ）の演算子が必要となる。局所的な雑音エネルギ推定に基づき各演算子のSNRを評価し、偽検出確率に基づくしきい値を設ける。しきい値を超える演算子が複数ある場合には、局在が最良となる最も狭い演算子の結果を採用する（Marr-Hildreth[18] の選択則と同趣旨）。小スケールで取りこぼしたエッジは大スケールが拾うため、全体としての検出-局在トレードオフをしきい値設定で調整できる。

複数スケール間での冗長反応を抑えるため、特徴合成（feature synthesis）を用いる。最小スケールのエッジから出発し、より大きなスケールで予測される応答（小スケールエッジをエッジ法線方向にガウスで畳み込み）と実応答を比較し、予測を有意に上回る場合にのみ大スケール新規エッジを追加する。これにより、スケール間で空間的にずれる冗長エッジの重複標示を避け、陰影やテクスチャ境界など実際に大スケールで新たに現れるエッジのみを追加できる（図8, 図9）。


IX. 方向性演算子の必要性（The Need for Directional Operators）
投影関数（エッジ方向に沿う窓）を長くすると、SNR と局在は改善する。ステップエッジを I(x,y)=A u(y) とし、f(x,y) を演算子とすると、エッジ応答 E は ∫∫ f dxdy、雑音応答は (n_0^2 ∫∫ f^2 dxdy)^{1/2} に比例する。エッジ方向に沿って f を伸長スケーリングすると、E は伸長率に比例し、分母は伸長率の平方根に比例するため、SNR は伸長率の平方根だけ改善する（局在も同様に改善）。現実の画像ではエッジの長さと曲率に制約があるため、適用性の判定が必要である。

効率的な長尺方向性マスクの生成法として、同一方向の非伸長マスクの出力をエッジ方向に沿う等間隔サンプリング（5点など）で合成する手法を用いる（図10）。このとき、サンプル値の分散を用いて直線エッジモデルへの適合度（goodness-of-fit）を評価し、分散が大きい場合（曲率が大・方向不一致）には方向性マスク出力を抑制し、非伸長演算子の結果を用いる。これにより、従来の方向性演算子の難点（曲線への誤反応、角の延長など[12]）を避けられる。

方向の離散化：2N+1 サンプルの方向性マスクで、演算子の好み方向とエッジ方向のなす角 θ に対する正規化出力は
O(θ) = cos θ · (1/(2N+1)) Σ_{n=-N}^N exp( -(n d sin θ)^2/(2σ^2) )
となり、方向応答の角度選択性が評価できる。実装例（d≈1.4、6方向）では最悪角15°で最大値の約85%まで出力が低下する程度である（図11）。


X. 結論（Conclusions）
本稿では、任意のエッジプロファイルに対するエッジ検出器設計手続きを示した。検出と位置特定の数学的基準を定式化し、多重応答制約を加えることで直観的な「良い検出」の要件を満たすようにした。数値最適化でリッジおよびルーフの最適演算子を求め、ステップエッジに特化した解析ではスケールに関して一意な最適形状（ガウシアン一次微分に近似可能）と、検出-局在の不確定性原理（トレードオフ）を示した。

実装では、雑音推定に基づく適応的ヒステリシスしきい値、複数スケールの採用、特徴合成によるスケール間統合を行い、同一点で異なるスケールのエッジが共存する場合にも整合的に統合できることを示した。二次元では、勾配方向での極大は方向二次微分のゼロ交差に対応し、エッジ方向に沿う投影（伸長）を持つ方向性演算子が局在・検出性能の改善に有効であることを示した。効率的な方向性マスク生成と適合度判定により、複数方向・複数スケールの出力を一貫して統合できる。

今後の課題として、異種検出器（エッジとリッジ等）の出力を単一記述に一貫的に統合する方法が挙げられる。エッジ検出の基準はコーナ等の非線形二次元特徴へも拡張可能であり、高次元画像（トモグラフィなど）の高次元エッジ検出にも一般化できる（ガウス畳み込みの分離性により効率も保たれる）。


参考文献（References）
[1] R. J. Beattie, “Edge detection for semantically based early visual processing,” Ph.D. dissertation, Univ. Edinburgh, 1984.
[2] C. Bingham, M. D. Godfrey, and J. W. Tukey, “Modern techniques of power spectrum estimation,” IEEE Trans. Audio Electroacoust., vol. AU-15, no. 2, pp. 56–66, 1967.
[3] R. A. Brooks, “Symbolic reasoning among 3-D models and 2-D images,” Stanford Univ., Rep. AIM-343, 1981.
[4] J. F. Canny, “Finding edges and lines in images,” MIT AI Lab., AI-TR-720, 1983.
[5] F. S. Cohen et al., “...,” Proc. ICPR, 1984.
[6] R. Courant and D. Hilbert, Methods of Mathematical Physics, vol. 1, Wiley, 1953.
[7] J. R. Fram and E. S. Deutsch, “On the quantitative evaluation of edge detection schemes...,” IEEE Trans. Comput., 1975.
[8] M. Gennert, “Detecting half-edges and vertices in images,” CVPR, 1986.
[9] R. W. Hamming, Digital Filters, Prentice-Hall, 1983.
[10] R. M. Haralick, “Zero-crossings of second directional derivative edge operator,” SPIE, 1982.
[11] A. Herskovits and T. O. Binford, “On boundary detection,” MIT AI Memo 183, 1970.
[12] E. C. Hildreth, “Implementation of a theory of edge detection,” MIT AI-TR-579, 1980.
[13] E. C. Hildreth, The Measurement of Visual Motion, MIT Press, 1983.
[14] B. K. P. Horn, “The Binford-Horn line-finder,” MIT AI Memo 285, 1971.
[15] D. G. Luenberger, Introduction to Linear and Nonlinear Programming, Addison-Wesley, 1973.
[16] I. D. G. Macleod, “On finding structure in pictures,” in Picture Language Machines, Academic, 1970.
[17] D. C. Marr, “Early processing of visual information,” Phil. Trans. R. Soc. B, 1976.
[18] D. C. Marr and E. Hildreth, “Theory of edge detection,” Proc. R. Soc. B, 1980.
[19] D. C. Marr and T. Poggio, “A theory of human stereo vision,” Proc. R. Soc. B, 1979.
[20] J. E. W. Mayhew and J. P. Frisby, “Psychophysical and computational studies...,” Artificial Intelligence, 1981.
[21] T. Poggio, H. Voorhees, and A. Yuille, “A regularized solution to edge detection,” MIT AIM-833, 1985.
[22] A. P. Pentland, “Visual inference of shape...,” Ph.D., MIT, 1982.
[23] J. M. S. Prewitt, “Object enhancement and extraction,” in Picture Processing and Psychopictorics, 1970.
[24] S. O. Rice, “Mathematical analysis of random noise,” Bell Syst. Tech. J., 1945.
[25] A. Rosenfeld and M. Thurston, “Edge and curve detection...,” IEEE Trans. Comput., 1971.
[26] L. Spacek, “The computation of visual motion,” Ph.D., Univ. Essex, 1984.
[27] K. A. Stevens, “Surface perception from local analysis of texture and contour,” MIT AI-TR-512, 1980.
[28] V. Torre and T. Poggio, “On edge detection,” MIT AIM-768, 1984.
[29] S. Ullman, The Interpretation of Visual Motion, MIT Press, 1979.
[30] N. Wiener, Extrapolation, Interpolation and Smoothing of Stationary Time Series, MIT Press, 1949.
[31] A. P. Witkin, “Shape from contour,” MIT AI-TR-589, 1980.

著者略歴（Author）
John Canny — 低レベル視覚、モデルベース視覚、ロボットモーションプランニング、計算代数等に関心。ACM 学生会員。

備考
・本訳は当該PDFから抽出された本文に基づく完全日本語訳であり、数式は可読性のため可能な範囲で原式のまま記述しています。
・原論文中の図番号・表の言及（図1〜11など）は本文の説明に従いそのまま残しています（本ファイルには図は含まれません）。
