# 修正 SSIM を用いる二段階クラスタリング・アルゴリズムによる総観循環パターンの分類

本ファイルは、以下の論文 PDF から抽出されたテキストを基に、日本語で可能な限り正確に翻訳・整形したものです。PDF の性質上、図・表・数式・レイアウトの一部に崩れや文字化けがあり得ます。該当箇所は原文の記法を保つか、コードブロックで示し、注記を付しています。内容の削除は行っていません。

- 書誌情報:
  - Earth Syst. Dynam., 15, 607–633, 2024
  - https://doi.org/10.5194/esd-15-607-2024
  - © Author(s) 2024. CC BY 4.0
- 論文種別: Research article
- タイトル: Classification of synoptic circulation patterns with a two-stage clustering algorithm using the modified structural similarity index metric (SSIM)
- 著者: Kristina Winderlich, Clementine Dalelane, Andreas Walter
- 所属: Deutscher Wetterdienst（ドイツ気象庁）Climate and Environment Consultancy Department, 63067 Offenbach am Main, Germany
- 連絡先: Kristina Winderlich (kristina.winderlich@dwd.de)
- 受理履歴: Received 2 Nov 2023; Discussion 20 Nov 2023; Revised 26 Mar 2024; Accepted 30 Mar 2024; Published 21 May 2024

---

要旨（Abstract）

本研究では、気候シミュレーションの評価ルーチン拡張を目的として、総観循環パターンの新たな分類手法を開発する。本分類は、参照データがあれば地球上の任意領域・任意サイズに適用可能であり、その独自性はクラスター構築に伝統的な距離指標ではなく修正構造類似度指標（SSIM）を用いる点にある。本手法は、階層的凝集型クラスタリング（HAC）と k-medoids という古典的アルゴリズム 2 種を反復的に組み合わせ、事前設定パラメータを 1 つ（2 つの総観パターン間の SSIM 類似度閾値）のみに限定する。閾値はユーザが設定し、2 画像の類似（構造・輝度・コントラスト）に対する人間の知覚を模倣する。最終クラス数は自動的に決定される。

本 SSIM ベース分類を ERA-Interim（1979–2018）の 500 hPa 面地衡高度に適用し、(1) 入力パラメータの変化に対して整合的、(2) クラス間分離が良好、(3) 空間的安定、(4) 時間的安定、(5) 物理的に意味がある、ことを示す。

さらに、新分類で得た総観クラスを用いて CMIP6 歴史気候シミュレーションや別の再解析（比較用）を評価する例を示す。CMIP6 出力（および代替再解析）をクラスへ割当て、クラスの頻度・遷移・持続確率の整合度として Jensen–Shannon 距離を算出し、モデル評価のための一般的な指標群に補完的な距離指標としての利用を提案する。

---

1. 序論（Introduction）

世界の研究機関は気候研究を進め、IPCC を通じて社会や政策決定者に知見を共有している。CMIP の各フェーズを通じ、モデル数の増加に伴い「品質」と「信頼性」に関する新たな要件が生じた。普遍的で完全に客観的な評価手順は存在せず、広範な指標を含めることが重要であるが、用途に応じた指標部分集合が必要となる。

総観レジーム（典型パターン）の表現と持続性はモデルの気候変動再現や外力（地球温暖化など）に対する応答の適切さに関わる。従来のモデル評価は個々の変数や指標に基づくが、これは原因でなく症状を示すことも多い。モデル性能が天候型に依存することが示されており、評価においてモデルの総観挙動を考慮することを提案する。

大気循環は連続的に変化するが、有代表的な「状態」や「典型パターン」（クラス）で記述可能である。準定常的なパターンで表すことは物理的に意味がある（Hochman et al., 2021）。評価のため、任意の気候モデルは事前に分類された総観状況のシーケンスで表現でき、そのクラス別頻度や持続などを再解析と比較し得る。

分類の構築に際しては空間・時間スケール、頻度・持続の扱い、クラス数の妥当性など非自明な設計判断がある。専門家の主観によるもの（Hess–Brezowsky, Lamb など）と自動分類があり、COST Action 733 で体系化が試みられてきた。多クラス法は構造差の強い分割を志向する一方、稀なクラスが少数・空になることがある。少クラス法はレジームの解析に有用だが、パターン多様性の取り扱いが最適でないことがある。

本研究の目的は、スカラー指標に支えられた従来の評価ルーチンを、天候型の正しさを診断する診断群で拡張することにある。自動分類に望む性質は、(i) 構造的差異の強いクラス、(ii) 任意領域に適用可、(iii) クラス内均質性、(iv) ほぼ全状況を包含（未分類を極小化）である。稀な状況は激甚気象に関係し得るため、除外すべきでない。SOM ベースや k-means＋ユークリッド距離に依存する既存手法は、平均場をクラス中心とすることや距離指標の構造鈍感性、クラス数の事前指定などの制約を抱える。

本論文では、修正 SSIM を類似度として用い、クラス中心にセントロイドではなくメドイドを採用し、HAC と k-medoids を反復結合してクラス数を自動決定する新しい二段階法を提案する。これにより、稀な状況を含む全入力を事前フィルタなしに分類し、構造的に異なるクラス群を自動構築する。

---

2. データ（Data）

本研究では 4 種のデータを用いる。

1) 合成データ: 分類手法の挙動を示すため、ガウス形状の異常を持つ 1000 フィールド（22×22 グリッド）を生成。各場は大きな異常 1 個と小異常 10 個（ランダム位置・符号）を持ち、線形シフトも加える。クラスタリングは、最大異常の位置と符号で支配されるクラスタを生むべきである。例は図1。

2) ERA-Interim（1979–2018）: 欧州域の 500 hPa 面地衡高度 z_g を 12UTC の日次で取得。空間サンプリングは 2°×3°（COST 733 推奨）。総観スケールでは高解像は不要。季節変動（平均・分散）は季節により変わるため、日別平均 μ_zg と標準偏差 σ_zg（各格子・各暦日、151 日移動平均で平滑）を用いて正規化し、異常場 z_g^a を得る：

```
z_g^a = (z_g - μ_zg) / σ_zg        (1)
```

さらに、地上気温 tas と日降水量 pr の 90 パーセンタイル超過の頻度図も作成し、各クラスに紐づく超過確率を評価する（図14ほか）。

3) 代替再解析 NCEP1: 再解析同士は観測を共有するため、代替再解析の評価は距離指標の到達下限の目安となる。

4) CMIP6（1979–2014）: 32 モデルの 500 hPa 面地衡高度を用い、参照クラスに帰属させて統計比較を行う（HIST/TRANSIT/PERSIST、Jensen–Shannon 距離）。

---

3. 手法（Method）

3.1 SSIM とその修正

SSIM（Wang et al., 2004）は画像の構造（共分散）、輝度（平均）、コントラスト（分散）に基づく類似度で、−1〜1 をとる。同一画像で 1、負相関で負値になり得る。大領域の 1 値で扱い、緯度高域を含むため面積重みを付す。

原式：

```
SSIM(x, y) = ((2 μ_x μ_y + c1) (2 σ_xy + c2)) / ((μ_x^2 + μ_y^2 + c1) (σ_x^2 + σ_y^2 + c2))      (2)
```

ただし気候応用では混合符号・平均ゼロ正規化が一般的で、原式の積 μ_x μ_y と σ_xy の符号により不都合がある。Mo et al. (2014) は両場を最小値でシフトして非負化するが、平均差の感度が弱まる。そこで本研究では、平均項のみを変換して分母の大きさを過度に変えず、平均差を保持する修正版を用いる：

```
SSIM(x, y) = ((2 μ_x' μ_y' + c1) (2 σ_xy + c2)) / (((μ_x')^2 + (μ_y')^2 + c1) (σ_x^2 + σ_y^2 + c2))      (3)

μ_x' = |μ_x| + |μ_y| / 2        (4)
μ_y' = μ_x' + |μ_x - μ_y|       (5)
```

定数は c1 = c2 = 1e−8（Baker et al., 2022）とした。

合成データ（図1）や実データ（図3）で、MSE が小さくても SSIM が低い例があり、構造類似の捉えに MSE は不適であることを例示する。

3.2 合成データに対する k-means の修正実験

同一の初期 9 クラス（HAC＋SSIM による独立初期化）から、(1) k-means＋MSE、(2) k-means＋SSIM、(3) k-medoids＋SSIM を比較。k-means＋MSE は平均化で構造が薄れ、スノーボール（要素が集積し更に構造が消える）を生みやすい。k-means＋SSIM は形状は保持しやすいが、平均化のため振幅が弱くなる。k-medoids＋SSIM はクラス中心をメドイド（クラス要素の代表）にすることで、構造と振幅を保ちつつノイズや外れ値への頑健性が高く、スノーボールを回避できる（図4）。

3.3 初期化と二段階アルゴリズム

PCA による初期化は、独立モードの混合や偽双極子の生成などの問題が指摘される（Fulton and Hegerl, 2021; Huth and Beranová, 2021）。稀な総観の除外も起こし得るため、採用しない。代わりに HAC により初期クラスを作り、k-medoids で再割当する二段階を反復して、類似度閾値 TH_merge を満たす限りクラスタを併合・再編成する。

二段階の概要：

- ステップ1（HAC: 併合）
  - クラスタ間のメドイド同士の SSIM が TH_merge を超えるものから優先に併合
  - 併合後にメドイドを再計算
- ステップ2（k-medoids: 再編成）
  - ステップ1のメドイドで初期化し、各要素を最も類似のメドイドに再割当
  - 収束までメドイド再計算を繰り返す

この 1→2 を繰り返し、併合すべき類似クラスタが無くなれば停止。唯一の事前設定は TH_merge のみで、これは人間の視覚的な「似ている」感覚に対応するよう 0.40〜0.45 程度が妥当と判断した（図5）。

3.4 性能評価基準と TH_merge の選定

Huth (1996) による 4 基準で評価: (i) パラメータに対する整合性、(ii) クラス分離、(iii) 時間・空間安定性、(iv) 物理的妥当性。分離の定量化として COST733 の EV（説明変動率）、DRATIO（クラス内距離/クラス間距離）に加え、SSIM に基づく SSIMRATIO（クラス内類似/クラス間類似）を導入：

```
EV = 1 - WSS/TSS                                         (6)
DRATIO = DI/DO                                           (7)
SSIMRATIO = SSIM_in / SSIM_out                           (8)

SSIM_in  = 平均（各クラスの全要素間 SSIM の平均）         (9)(10)
SSIM_out = 平均（各クラス要素と他クラス全要素の SSIM 平均） (11)(12)
```

また、クラス集合間の類似を、各クラスの出現頻度で重み付けた平均類似 mwSSIM で評価：

```
mwSSIM(k, l) = Σ_i SSIM(i, j(i)) * HIST_k(i)             (13)
```

HIST_k(i) は集合 k におけるクラス i の頻度。minNYR（安定なクラス数に達する最小年数）はおよそ 30 年と判断。

---

4. 結果（Results）

4.1 TH_merge とクラス数

参照データ（40 年）に対し TH_merge = 0.40/0.425/0.45 で得られたクラス数は 37/52/89。ランダム抽出や初期条件ランダマイズを含む 61 回の推定では平均 42±6、59±4、84±5（図6）。本手法は稀な状況も分類するためクラス数が多くなる。TH_merge=0.40 の 37 クラスの頻度分布を図7、上位 6 クラスのフル場（平均＋異常）を図8に示す。これらは GWL-REA v1.3（James and Ostermöller, 2022）の天候型と良く対応し、物理的妥当性を示す。

4.2 クラス進化の整合性

1 年データで TH_merge を 0.40→0.425→0.45 と上げたときのクラス対応を「矢印図」（図9）で示す。多くのクラスが同一または強類似で保たれ、分割に伴う新生クラスが一部現れるが、進化は整合的。

4.3 クラス分離

EV、DRATIO、SSIMRATIO を表1に示す。EV はクラス数が多いほど増加する性質があるため、相対比較に用いる。DRATIO は小さいほど分離が良く、TH_merge=0.45 が最小。ただし SSIMRATIO（類似度ベースの分離指標）は TH_merge=0.40 が最大であり、クラス間の類似をより低く抑え、クラス内の類似を高める観点で有利。以降の詳細解析には TH_merge=0.40（37 クラス）を採用する。併せて、メドイド対の SSIM が TH_merge 未満であること（停止条件）に加え、セントロイド対でも SSIM<0.60（強類似未満）であることを確認（図10）。

4.4 安定性

- 時間安定性: 図6より 30 年程度でクラス数が頭打ち。minNYR=30 年で 61 セットのクラス間 mwSSIM 行列を算出したところ、最小 0.53、平均 0.63 と、いずれも 0.40 を上回り、安定性が確認できた（図11）。35 年・40 年でも同様（本文）。
- 空間安定性: 2°×3°（基準）に対し、4°×6°と 1°×1.5°でも独立に分類を実行。参照クラスに対する各解像度の対応クラスの SSIM は平均で 0.53（低解像）/0.52（高解像）と、しきい値を上回る安定性を示した（図12）。

4.5 クラス代表性（メドイド vs セントロイド）

各クラスのメドイドとセントロイドの SSIM は全 37 クラスで 0.60 以上（表2）。平均 0.78（頻度重み 0.79）。メドイドはセントロイドの構造を強く保持し、クラスがスノーボールではないこと、クラス内構造の同質性が確保されていることを示す（図13）。

---

5. 総観クラスに紐づく極端現象（Weather extremes）

tas と pr の 90 パーセンタイル超過確率図を、各クラス（特にドイツ域）で算出。例として SP5 は特筆なし、SP2 は全国的に降水超過（南で顕著）、稀な SP35 は高温、SP29 は高温かつ多雨を示す（図14）。全クラスの図は補遺参照（本文記載）。降水はモデルで難しい変数であり、特定の総観の再現可否が偏差の原因分離（物理 vs 動力学）に資する。

---

6. CMIP6 の統計と Jensen–Shannon 距離による評価

参照クラスに対し、各データ（代替再解析・CMIP6）を SSIM により帰属させ、以下の統計を算出。

- HIST: 全期間のクラス頻度（および季節別 HIST_DJF/MAM/JJA/SON）
- TRANSIT: クラス間遷移頻度
- PERSIST: クラスの 1,2,…日の持続確率

高次元ベクトル/行列の比較には、各成分を頻度で重み付けた Jensen–Shannon ダイバージェンス（対称・有限）およびその平方根の距離を用いる：

```
JSD(P || Q) = 1/2 Σ P ln(P/M) + 1/2 Σ Q ln(Q/M)          (14)
JS(P || Q)  = sqrt(JSD(P || Q))                           (16)
M = (P + Q)/2                                             (15)
```

結果の例を図15に、32 モデルの各統計に対する JS と平均 JS を表3に示す。代替再解析 NCEP1 の平均 JS は 0.034 がベンチマーク。NorESM2-LM は 0.137 と相対的に大きく、他は 0.10 前後が多い。Sanderson et al. (2015) による品質指数に変換して、スカラー指標と共に総合評価に用いることを提案する。

---

7. 結論（Conclusions）

修正 SSIM を用いる二段階クラスタリング（HAC＋k-medoids）は、500 hPa 地衡高度異常に基づく総観パターンの分類において、クラス間の分離、パラメータ変化に対する整合性、時間・空間安定性、物理的妥当性を備えたクラス集合を構築できる。入力全体を事前フィルタやクラス初期化なしに扱い、稀な状況も含めて自動的にクラス化する。k-means＋MSE の欠点（構造鈍感・スノーボール）を回避しつつ、メドイド採用により代表性・頑健性を確保した。

本法は任意領域に適用可能で、準全球的なモデル評価にも拡張できる。得られたクラスに対する HIST/TRANSIT/PERSIST と Jensen–Shannon 距離は既存のスカラー指標を補完する診断となり、「結果は合っているが理由が違う」ケースの検出に有用である。総観クラスと極端現象の結び付けは予測可能性の向上にも資し得るが、本研究では評価用途を主に想定する。

---

コード・データ利用可能性（Code and data availability）

- ERA-Interim: https://www.ecmwf.int/en/forecasts/dataset/ecmwf-reanalysis-interim
- NCEP1: https://psl.noaa.gov/data/gridded/data.ncep.reanalysis.html
- CMIP6: https://esgf-node.llnl.gov/search/cmip6/

補遺（Supplement）

- https://doi.org/10.5194/esd-15-607-2024-supplement

著者貢献（Author contributions）

- 方法設計: KW, CD
- SSIM 修正: CD
- 実装（Fortran）・分類・原稿整備: KW（共著者貢献あり）

競合利益（Competing interests）

- なし

免責（Disclaimer）

- 本サービスは ECMWF のデータ・プロダクトに基づく。地名等の最終責任は著者にある。

査読（Review statement）

- 編集: Gabriele Messori、匿名査読 3 名

---

参考文献（References）

（以下、原文の参考文献リストを和訳のまま配列・書式を簡略化して掲載。誌名・巻・頁・DOI は原文準拠）

Adams, R. E., et al., 2020. Int. J. Climatol., 41, 92–103.  
Baker, A. H., et al., 2022. IEEE TVCG (Early Access).  
Baur, F., 1948. Einführung in die Grosswetterkunde.  
Beck, C., et al., 2007. Int. J. Climatol., 27, 473–491.  
Cannon, A. J., 2012. Int. J. Climatol., 32, 2251–2254.  
Cannon, A. J., 2020. Environ. Res. Lett., 15, 064006.  
Cannon, A. J., et al., 2001. Mon. Weather Rev., 130, 1187–1206.  
Cassano, E. N., et al., 2006. Clim. Res., 30, 83–97.  
D’Urso, P., Massari, R., 2019. Inform. Sciences, 505, 513–534.  
Dee, D. P., et al., 2011. QJRMS, 137, 553–597.  
Díaz-Esteban, Y., et al., 2020. Climate, 8, 1–18.  
Dittmann, E., et al., 1995. DWD.  
Dorrington, J., Strommen, K. J., 2020. GRL, 47, e2020GL087907.  
ESGF, CMIP6 data portal, 2024.  
Eyring, V., et al., 2016. GMD, 9, 1937–1958.  
Fabiano, F., et al., 2020. Clim. Dyn., 54, 5031–5048.  
Falkena, S. K. J., et al., 2021. QJRMS, 148, 434–453.  
Fettweis, X., et al., 2010. Clim. Dyn., 36, 139–159.  
Fulton, D. J., Hegerl, G. C., 2021. J. Climate, 34, 7645–7660.  
Gerstengarbe, F.-W., Werner, P. C., 1993. DWD.  
Gervais, M., et al., 2016. J. Climate, 29, 2359–2373.  
Gleckler, P. J., et al., 2008. JGR, 113, D06104.  
Grams, C. M., et al., 2017. Nat. Clim. Change, 7, 557–562.  
Hannachi, A., et al., 2017. Rev. Geophys., 55, 199–234.  
Herrera-Lormendez, P., et al., 2021. Int. J. Climatol., 42, 4062–4077.  
Hess, P., Brezowsky, H., 1952. DWD.  
Hewitson, B. C., Crane, R. G., 2002. Clim. Res., 22, 13–26.  
Hochman, A., et al., 2021. GRL, 48, e2021GL095574.  
Huth, R., 1996. Int. J. Climatol., 16, 893–922.  
Huth, R., 2000. Theor. Appl. Climatol., 67, 1–18.  
Huth, R., Beranová, R., 2021. Earth Space Sci., 8, e2020EA001275.  
Huth, R., et al., 2008. Ann. NY Acad. Sci., 1146, 105–152.  
James, P. M., 2006. Theor. Appl. Climatol., 88, 17–42.  
James, P., Ostermöller, J., 2022. EMS2022-415.  
Jiang, N., et al., 2011. Int. J. Climatol., 32, 1475–1494.  
Kalnay, E., et al., 1996. BAMS, 77, 437–471.  
Kaufman, L., Rousseeuw, P. J., 1990. Wiley.  
Kohonen, T., 2001. Springer.  
Lamb, H. H., 1972. HMSO.  
Lauscher, F., 1985. ZAMG.  
Lee, C. C., Sheridan, S. C., 2012. Int. J. Climatol., 32, 1792–1802.  
Meehl, G. A., et al., 1997; 2000; 2007.  
Milligan, G. W., 1985. Psychometrika, 50, 123–127.  
Mo, R., et al., 2014. J. Hydrometeor., 15, 1862–1880.  
Muñoz, Á. G., et al., 2017. J. Climate, 30, 8951–8972.  
Nguyen-Le, D., Yamada, T. J., 2019. Weather Forecast., 34, 345–360.  
Nigro, M. A., et al., 2011. Weather Forecast., 26, 184–198.  
Perez, J., et al., 2014. Clim. Dyn., 43, 2663–2680.  
Philipp, A., et al., 2010. Phys. Chem. Earth, 35, 360–373.  
Radić, V., Clarke, G. K. C., 2011. J. Climate, 24, 5257–5274.  
Riediger, U., Gratzki, A., 2014. Meteorol. Z., 23, 231–252.  
Sanderson, B. M., et al., 2015. J. Climate, 28, 5171–5194.  
Schubert, E., Rousseeuw, P. J., 2021. Information Systems, 101, 101804.  
Taylor, K. E., et al., 2012. BAMS, 93, 485–498.  
Tveito, O. E., et al., 2016. COST Action 733 最終報告.  
Wang, Z., Bovik, A. C., 2009. IEEE Signal Proc. Mag., 26, 98–117.  
Wang, Z., et al., 2004. IEEE TIP, 13, 600–612.  
Yarnal, B., et al., 2001. Int. J. Climatol., 21, 1923–1950.

---

図表・数式に関する注記

- 図1–15、表1–3 の実画像は PDF 抽出の都合で未収録。キャプションの要旨と本文説明により内容を反映している。
- 数式は PDF 由来のため体裁を簡略化し、コードブロックで提示した。
