# 海面更正気圧パターン分類における類似度指標の統計的相互比較

著者:

- 佐藤 拓人（筑波大学 生命環境科学研究科）
- 日下 博幸（筑波大学 計算科学研究センター）

掲載情報:

- Journal of the Meteorological Society of Japan, 99(4), 993–1001, 2021
- doi: 10.2151/jmsj.2021-047
- クリエイティブ・コモンズ CC BY 4.0（https://creativecommons.org/licenses/by/4.0/）

種別: Notes and Correspondence

対応著者:

- 日下 博幸（〒 305-8577 茨城県つくば市天王台 1-1-1 筑波大学 計算科学研究センター）
- E-mail: kusaka@ccs.tsukuba.ac.jp

J-STAGE Advance Published: 2021 年 4 月 14 日

キーワード: 類似度指標、天気図、分類

---

## 要旨（Abstract）

本研究では、天気図分類において海面更正気圧（SLP）パターンを正確に抽出するための 5 つの代表的な類似度指標（相関係数、ユークリッド距離（EUC）、S1 スコア（S1）、構造的類似度（SSIM）、平均ハッシュ（aHash））の精度を比較する。多数の教師データを用いて各指標の精度を統計的に評価した結果、S1 と SSIM が平均値と最大値の両面で最高の精度を示した。さらに、非理想的な教師データを用いた場合でも両者の精度は低下しなかった。また、S1 と SSIM は EUC に比べて 2 つの天気図間の主観的な類似性をより良く再現できる。しかし、EUC は一例ではシグナルの中心位置を再現した。本研究は、特に非理想的な教師データを用いる際に、SLP パターン分類に最も有用な類似度指標を同定するための参考となる。

---

## 1. はじめに

天気図分類は気象学・気候学で広く用いられており、多様な分類手法が提案され、その有効性が議論されてきた（例: Huth et al., 2008）。分類手法は主観的（人手）と客観的（コンピュータ支援）に大別される。コンピュータ支援手法は人の主観より客観的で大規模データに適用可能であるため、気候学的解析で広く用いられる。代表例として、Ward 法、K-means クラスタリング、主成分分析（PCA；例: Key and Crane, 1986; Cheng and Wallace, 1993; Hoffmann and Schlünzen, 2013; Kato et al., 2013; Miyasaka et al., 2020）がある。自己組織化マップ（SOM；例: Hewitson and Crane, 2002; Cassano et al., 2006; Johnson et al., 2008; Ohba et al., 2016; Tamaki et al., 2018）やサポートベクターマシン（SVM；例: Kimura et al., 2009; Ortiz-García et al., 2014; Su et al., 2018）などの機械学習手法も分類や選択問題で用いられつつある。

客観的分類の精度を左右する重要要素が類似度指標であり、その精度は気象・気候の分野で広く議論されてきた（例: Gutzler and Shukla, 1984; Toth, 1991; Matulla et al., 2008; Tartaglione et al., 2009; Mo et al., 2014）。Matulla et al. (2008)はアナログ法（対象場に類似する履歴データを用いる予測手法）に対して、相関係数（COR）、ユークリッドノルム、S1 スコア（S1）の 3 指標の精度を評価し、最適な指標は対象変数に依存することを示した。Mo et al. (2014)は構造的類似度（SSIM）などの非伝統的類似度指標の視覚的類似性の捉え方を検討し、最適指標が事例（一次元か二次元か等）に依存することを示した。これらは、全ての問題や変数に一意に適用可能な単一の類似度指標を特定することが困難であることを示唆する。特に、雑音を含む教師データを用いる際にどの指標が有効かは不明である。

本研究では、海面更正気圧（SLP）パターンの選択において、相関係数（COR）、ユークリッド距離（EUC）、S1、SSIM、平均ハッシュ（aHash）の 5 指標の精度を比較する。aHash は他指標と異なる概念に基づく（詳細は 2.3 節）ため、その有効性の評価は迅速なコンピュータ支援分類手法の発展に資する。さらに、本論文の特徴として、雑音の有無（非理想教師データ／理想教師データ）双方の多数の教師データを用いる。実際の分類では常に理想教師データが用意できるとは限らない。例えば、日本海低気圧（CSoJ）の選択を考えると、理想教師データは CSoJ のみを含むが、非理想教師データは他擾乱や低気圧の位置ずれを含む。

---

## 2. 方法

### 2.1 データとターゲットパターン

対象は日本列島周辺の北西太平洋（120–170°E, 20–55°N）の SLP 天気図である。JRA-55 再解析（Kobayashi et al., 2015）を用い、2007–2016 年の 6 時間毎に作成した。水平解像度は 1.25 度。ターゲット SLP パターンは日本海低気圧（Cyclones over the Sea of Japan; 以下 CSoJ）であり、典型例を図 1 に示す。このパターンは日本の降雨・降雪を引き起こす代表的な SLP 場であり、分類精度の議論に適している。CSoJ は春・冬に多いが、本研究では SLP 天気図の類似性に着目して CSoJ を選択することを目的とするため、通年データを解析対象とした。

類似度計算に先立ち、CSoJ と非 CSoJ の主観（視覚）ラベリングを実施した（図 2）。まず著者らが全 SLP 図（14,612 枚）から CSoJ 候補（839 枚）を選択し、同数の非 CSoJ 候補を CSoJ 候補を除く全 SLP 図から乱数で抽出した（第 1 段階: Round 1）。次に 5 名の専門家に独立に CSoJ 候補と非 CSoJ 候補を判定してもらい、3 名以上が CSoJ（または非 CSoJ）と認定した図をそれぞれ CSoJ（328 枚）・非 CSoJ（788 枚）とした（第 2 段階: Round 2）。第 2 段階で採択された図は著者による第 1 段階（予備選定）に比べ主観バイアスが小さい。なお、専門家は第 1 段階の存在を知らされていない。最終的に 1,116 枚の SLP 図（以下、ラベル付きデータセット）を実験に用いた。

図 1: CSoJ パターンの天気図例（2007 年 3 月 5 日 12 UTC）。  
図 2: 主観ラベリング手順の概略図。

### 2.2 実験設計

SLP 図の分類における類似度指標の性能を評価するため、各類似度指標について以下のワークフロー（図 3）を実行した。

1. ラベル付きデータセットから教師 CSoJ データを一つ選ぶ（Step 1）。
2. 選んだ教師データと、教師を除くラベル付きデータセット中の他の全データとの類似度を計算する（Step 2）。
3. 類似度の降順に並べ替え、ランキングリストを作成する（Step 3）。

この手順を、328 組の CSoJ データ全てを教師データとして繰り返す。ランキングリストから、類似度指標の選択能力を表す選択率（Selection rate）を式(1)で計算する。

Selection rate:  
N_selected,p / N_total CSoJ … (1)

ここで N_total CSoJ は教師データを除いた CSoJ 枚数、N_selected,p はランキングの上位 p 枚に含まれる CSoJ 枚数である。p が小さくても選択率が高い場合、CSoJ が上位に集中しており、当該類似度指標の選択性能が高いことを示す。全 328 の教師データについて統計評価し、実用的分類に有用な指標を同定する。

図 3: ワークフローの概略図。

### 2.3 類似度指標

本研究で用いた類似度指標は COR、EUC、S1、SSIM、aHash の 5 種である。EUC、aHash、S1 は文献によっては「非類似度」と見なされることがある（値が大きいほど非類似）。しかし本研究の手順では、降順（または昇順）でソートすることにより、実質的に同等の扱いとなるため、便宜上 5 種を総称して類似度指標と呼ぶ。

a) 相関係数（Pearson の相関係数; COR）  
2 次元の SLP データを 1 次元ベクトルに変換し、相関係数 R を用いる。R は[-1, 1]に取り、1 に近いほど類似度が高い。式(2)（Taylor, 2001）で表される。

R = Σ (A_ij - Ā)(B_ij - B̄) / (N σ_A σ_B) … (2)  
A, B は 2 つの SLP 図、N は格子点数、σ は標準偏差。

b) ユークリッド距離（EUC）  
SLP パターンを多次元ベクトルと見なして EUC を用いる。類似度 D は式(3)で表す。

D = Σ_i Σ_j (A_ij - B_ij)^2 … (3)  
n_x, n_y は x・y 方向の格子点数。D が小さいほど類似。EUC は空間平均の差に強く影響されるため、空間平均が異なると類似パターンでも適切に評価されない。そこで本研究では EUC に限って SLP の空間偏差（アノマリー）を用いてバイアスを回避した。なお、2 図の空間分散を考えると COR と EUC には関係がある。

c) S1 スコア（S1）  
Teweles and Wobus (1954) により提案され、SLP や高度場の予報検証によく用いられる。水平方向の勾配を考慮するためである。S1 は 0 以上の値を取り、小さいほど類似（式(4)）。

S1 = (100/N) Σ max( |∂F/∂x - ∂A/∂x| + |∂F/∂y - ∂A/∂y| ) / max( |∂F/∂x| + |∂A/∂x| , |∂F/∂y| + |∂A/∂y| ) … (4)

ここで ∂/∂x, ∂/∂y は各方向の差分、F_i は予報値（本研究ではデータセット側）、A_i は参照値（本研究では教師データ）、D_i はその差を表す。

d) 構造的類似度（SSIM）  
Wang et al. (2004) により提案。輝度差 l(A,B)、コントラスト差 c(A,B)、構造差 s(A,B) を部分領域ごとに評価し、全領域で平均して画像全体の類似度 S を得る。本研究では 5×5 格子を評価窓として全 SLP 図を走査した。式(5)で表す。

SSIM(A,B) = l(A,B) · c(A,B) · s(A,B)  
= [(2 μ_A μ_B + C1)/(μ_A^2 + μ_B^2 + C1)] · [(2 σ_A σ_B + C2)/(σ_A^2 + σ_B^2 + C2)] · [(σ_AB + C3)/(σ_A σ_B + C3)] … (5)

C1=C2=C3=0.0、μ は評価窓の平均、σ は標準偏差、σ_AB は共分散。S ∈ [-1,1]で、1 に近いほど類似。

e) 平均ハッシュ（aHash）  
主に画像検索で用いられる（Krawetz, 2011; Fei et al., 2015; Haviana and Kurniadi, 2016）。画像ハッシングの類例は 2 次元気象場の高速類似検索にも使われる（Raoult et al., 2018）。対象画像の解像度を指定サイズに縮小し、平均値を閾値として上を 1、下を 0 としてビット列にハッシュする。類似度にはビット列のハミング距離（異なるビット数）を用い、これが小さいほど類似（完全一致で 0）。本研究では 16×16 ピクセルに縮小し 256 ビットにハッシュした。

以上より、EUC と COR は統計的要素（差・相関）を、SSIM と aHash は視覚的要素（知覚的類似性）を、S1 は気象学的要素（圧力勾配）を強調する。これらの性能比較により SLP 図分類に適した指標が明らかになる。

---

## 3. 結果

p=327（教師データを除く CSoJ 枚数）における平均・最大・最小の選択率を表 1 に示す。S1 は平均・最大の両指標で最高値を示し、SSIM は平均選択率で S1 にほぼ匹敵した。その他 3 指標（COR, EUC, aHash）は選択率が低く、相互の差も小さい。最小選択率も平均と同様の傾向を示す。5%水準の Wilcoxon の順位和検定では、aHash と他 4 指標の間に有意差が認められた。

図 4 は選択データ数と選択率の関係を示す。グラフが上に凸であるほど、p が小さくても CSoJ を選択できるため精度が高い。SSIM と S1 は、他指標に比べて上に凸の曲線が多く、下に凸の曲線が少ない。全教師データに対する平均曲線（黒太線）も、S1 と SSIM は他 3 指標より強い上方凸性を示した。

aHash は前処理で画像解像度を縮小して高周波成分を除去するが、これが精度に影響しうる。そこで、解像度 41×29（縮小なし）、16×16、8×8 で選択率を比較したところ、平均選択率はそれぞれ 39.3%、40.4%、40.7%であった。Bonferroni 補正を用いた多群検定（5%水準）では帰無仮説は棄却されなかった（有意差なし）。

aHash は二値化により水平勾配情報が失われる。一般画像では特徴抽出として有効だが、SLP パターンでは特徴と背景の区別が難しく、重要情報が失われ精度が低下し得る。このため、16×16 解像度で aHash と EUC の選択率を比較したところ、平均選択率は aHash=40.4%、EUC=40.0%で、5%水準の順位和検定では有意差なし。

図 5 は、2007 年 3 月 5 日 06 UTC の図を教師とした例である。この教師データでは CSoJ 中心は日本海北部に位置し、他の顕著なシグナルはない。2013 年 3 月 1 日 06 UTC は 3 指標全てで高順位（S1:6 位、EUC:3 位、SSIM:9 位）。2007 年 2 月 14 日 00 UTC は S1 と SSIM で高順位（S1:12 位、EUC:84 位、SSIM:15 位）。2012 年 11 月 6 日 18 UTC は EUC で高順位（S1:82 位、EUC:14 位、SSIM:76 位）。順位が小さいほど教師に近いことを意味する。2013 年 3 月 1 日 06 UTC は CSoJ の形状・中心、太平洋上の高気圧の見え方が類似し、視覚的類似性をよく表す。一方、2007 年 2 月 14 日 00 UTC は CSoJ 中心が南寄りで視覚的類似性は低い。2012 年 11 月 6 日 18 UTC は CSoJ 中心が北寄りだがシグナルが不明瞭で、CSoJ 形状や太平洋高気圧の見え方も教師と不一致である。

表 1: 各類似度指標の平均・最大・最小の選択率（%）。p=327（式(1)）

- COR: 平均 43.0, 最大 73.1, 最小 19.6
- EUC: 平均 39.0, 最大 64.2, 最小 19.9
- aHash: 平均 40.4, 最大 66.7, 最小 15.3
- SSIM: 平均 56.6, 最大 77.7, 最小 26.6
- S1: 平均 57.5, 最大 80.4, 最小 23.5

図 4: 類似度指標ごとの選択率曲線。灰線: 各教師データの曲線、黒太線: 平均曲線、急な点線: 理想（抽出全てが CSoJ）、緩い点線: ランダム抽出の期待線。  
図 5: 教師と抽出された SLP パターンの例（hPa）。各図上部の数値は各指標での順位。

---

## 4. 考察

5 つの類似度指標の比較から、S1 と SSIM は平均・最大の選択率で最も高精度であり、既存の分類手法にこれらを用いると精度向上が見込まれる。S1 は指標に水平圧力勾配を含み、SLP パターンの分類では周囲格子点の差（すなわち勾配情報）が重要であることを支持する。一方で、S1 は事例によっては性能が低いことも知られており（Toth, 1991）、更なる検討が必要である。

SSIM は S1 に匹敵する高成績であり、2 次元画像において EUC や COR より高精度という Mo et al. (2014)の結果と整合する。SSIM は平均、コントラスト、構造の差を総合評価し、視覚的類似性を説明するため、本研究でも類似天気図の抽出に有効だった。一般画像では二乗誤差よりも SSIM が高精度であることが示されており（例: Wang and Bovik, 2002）、本研究でも二乗誤差と近い EUC が SSIM に劣る結果はこれと整合する。完全な視覚的類似性を一つの指標で捉える難しさも示唆される。

二値化の影響について、EUC と aHash の平均選択率に差は見られなかった。これは、二値化が SLP パターン分類に必ずしも有効ではない可能性を示す。S1 の結果が示唆するように、水平勾配情報が重要であり、二値化により勾配表現が欠落すると性能低下が生じうる。ただし、シグナルが単純で勾配の大きさが重要でない場合には、aHash が他法より正確となる可能性もあり、パターン依存の評価が必要である。

各指標が強調する要素の違いも重要である。例えば、全指標で高順位のパターンは視覚的にも類似しているが、S1 と SSIM で高順位の例では CSoJ 中心がやや異なっても全体像は視覚的に類似する。一方、EUC で高順位の例では、CSoJ 全体像や特徴が教師と一致しない場合があり、中心位置の再現性が強調されることが示唆される。このように、選択率のみならず各指標の性質を考慮する必要がある。

本研究の限界として、教師データに CSoJ の SLP 図を用いた点が挙げられる。教師データが CSoJ と一致しない場合、結果は変わり得る。これは、教師データの信号対雑音比に依存し、比が高ければ aHash のような画像単純化ベース手法でも高精度となり得る。また、PCA による雑音除去や次元削減などの前処理により精度向上が見込める。データの空間解像度も重要であり、解像度が上がると EUC や COR で扱うベクトル次元が増え、分離度が低下する可能性がある。

---

## 5. 結論と所見

本研究では、SLP パターン分類に重要な 5 つの類似度指標（COR, EUC, S1, SSIM, aHash）を多数の教師データで評価した。全教師データの実験で、平均精度は S1 が最良で、最大精度でも最良であった。次点は SSIM であった。これは、雑音の多い教師データを用いる実用的分類でも S1 と SSIM が他指標より良好に機能する可能性を示す。一方、aHash の精度は EUC や COR と同程度であり、解像度縮小と二値化の影響が考えられる。

以上より、SLP パターン分類には視覚的要素（SSIM）と気象学的要素（S1）を強調する指標が有効であり、これらは EUC より視覚的類似性を良く再現した。ただし、EUC は CSoJ 中心位置の抽出に寄与する場合がある。今後は他の典型的 SLP パターンに焦点を当てた同様の実験により、より堅牢な結論を得る必要がある。加えて、PCA やフィルタによる雑音低減などの前処理法の比較により、分類・抽出の改善が期待される。

---

## 謝辞

本研究は環境再生保全機構の環境研究総合推進費（JPMEERF20192005）の支援を受けた。共同分類に協力いただいた 5 名の同僚と、分類試験に参加した 5 名の専門家に感謝する。また、有益な助言をいただいた西昭文博士に謝意を表する。

---

## 参考文献

- Cassano, E. N., A. H. Lynch, J. J. Cassano, and M. R. Koslow, 2006: Classification of synoptic patterns in the western Arctic associated with extreme events at Barrow, Alaska, USA. Climate Res., 30, 83–97.
- Cheng, X., and J. M. Wallace, 1993: Cluster analysis of the Northern Hemisphere wintertime 500-hPa height field: Spatial patterns. J. Atmos. Sci., 50, 2674–2696.
- Fei, M., J. Li, L. Shao, Z. Ju, and G. Ouyang, 2015: Robust visual tracking based on improved perceptural hashing for robot vision. Lecture Notes in Computer Science, 11742, Springer, 331–340.
- Gutzler, D. S., and J. Shukla, 1984: Analogs in the wintertime 500 mb height field. J. Atmos. Sci., 41, 177–189.
- Haviana, S. F. C., and D. Kurniadi, 2016: Average hashing for perceptual image similarity in mobile phone application. J. Telematics Inf., 4, 12–18.
- Hewitson, B. C., and R. G. Crane, 2002: Self-organizing maps: Applications to synoptic climatology. Climate Res., 22, 13–26.
- Hoffmann, P., and K. H. Schlünzen, 2013: Weather pattern classification to represent the urban heat island in present and future climate. J. Appl. Meteor. Climatol., 52, 2699–2714.
- Huth, R., 1996: An intercomparison of computer-assisted circulation classification methods. Int. J. Climatol., 16, 893–922.
- Huth, R., et al., 2008: Classifications of atmospheric circulation patterns: Recent advances and applications. Ann. New York Acad. Sci., 1146, 105–152.
- Johnson, N. C., S. B. Feldstein, and B. Tremblay, 2008: The continuum of Northern Hemisphere teleconnection patterns and a description of the NAO shift with the use of self-organizing maps. J. Climate, 21, 6354–6371.
- Kato, H., Y. Nagano, and S. Tanaka, 2013: Objective classification of the sea level pressure distribution pattern in East Asia. Geogr. Rev. Japan Series A, 86, 95–114（和文・英文抄録付）.
- Key, J. R., and R. G. Crane, 1986: A comparison of synoptic classification schemes based on ‘objective’ procedures. Int. J. Climatol., 6, 375–388.
- Kimura, H., H. Kawashima, H. Kusaka, and H. Kitagawa, 2009: Detection of pressure patterns using support vector machine: Winter type pressure pattern. Geogr. Rev. Japan Series A, 82, 323–331（和文・英文抄録付）.
- Kobayashi, S., et al., 2015: The JRA-55 reanalysis: General specifications and basic characteristics. J. Meteor. Soc. Japan, 93, 5–48.
- Krawetz, N., 2011: Looks like it. The Hacker Factor Blog. http://hackerfactor.com/blog/index.php%3F/archives/432-Looks-Like-It.html
- Matulla, C., et al., 2008: Influence of similarity measures on the performance of the analog method for downscaling daily precipitation. Climate Dyn., 30, 133–144.
- Miyasaka, T., et al., 2020: Future projections of heavy precipitation in Kanto and associated weather patterns using large ensemble high-resolution simulations. SOLA, 16, 125–131.
- Mo, R., C. Ye, and P. H. Whitfield, 2014: Application potential of four nontraditional similarity metrics in hydrometeorology. J. Hydrometeor., 15, 1862–1880.
- Ohba, M., S. Kadokura, D. Nohara, and Y. Toyoda, 2016: Rainfall downscaling of weekly ensemble forecasts using self-organising maps. Tellus A, 68, 29293.
- Ortiz-García, E. G., S. Salcedo-Sanz, and C. Casanova-Mateo, 2014: Accurate precipitation prediction with support vector classifiers. Atmos. Res., 139, 128–136.
- Raoult, B., et al., 2018: Fast retrieval of weather analogues in a multi-petabytes archive using wavelet-based fingerprints. Lecture Notes in Computer Science, 10861, Springer, 697–710.
- Su, S.-H., J.-L. Chu, T.-S. Yo, and L.-Y. Lin, 2018: Identification of synoptic weather types over Taiwan area with multiple classifiers. Atmos. Sci. Lett., 19, e861.
- Tamaki, Y., M. Inatsu, D. Nguyan-Le, and T. J. Yamada, 2018: Heavy rainfall duration bias in dynamical downscaling and related synoptic patterns. J. Appl. Meteor. Climatol., 57, 1477–1496.
- Tartaglione, N., et al., 2009: Resemblance between SLP patterns leading to intense precipitation over Italy. Theor. Appl. Climatol., 95, 183–196.
- Taylor, K. E., 2001: Summarizing multiple aspects of model performance in a single diagram. J. Geophys. Res., 106, 7183–7192.
- Teweles, S., Jr., and H. B. Wobus, 1954: Verification of prognostic charts. Bull. Amer. Meteor. Soc., 35, 455–463.
- Toth, Z., 1991: Intercomparison of circulation similarity measures. Mon. Wea. Rev., 119, 55–64.
- Wang, Z., and A. C. Bovik, 2002: A universal image quality index. IEEE Signal Process. Lett., 9, 81–84.
- Wang, Z., A. C. Bovik, H. R. Sheikh, and E. P. Simoncelli, 2004: Image quality assessment: From error visibility to structural similarity. IEEE Trans. Image Process., 13, 600–612.
