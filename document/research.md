# 類似度指標とクラスタリング手法の比較を通じた気圧配置パターン分類の高度化

## 先行研究レビュー

### 1) 木村ほか (2009)「サポートベクターマシンを用いた気圧配置の自動分類（DEIM Forum 2009）」

- 目的
  - 目視で行っていた「西高東低」「谷」「移動性高気圧」「前線」「南高北低」「台風」の抽出を、SVM で自動化。
- データ・設定
  - 入力：JRA‑25 の海面更正気圧（SLP）、日本周辺（約 1.25°）2109 格子、毎日 09JST。
  - ラベル：吉野（2002）の 6 基本型（移行・複合あり）。
  - 手法：各型ごとに「その型を持つ/持たない」の二値 SVM（RBF カーネル）、一対他。TinySVM を利用。
- 主な結果
  - F 値（参考）：西高東低 ≈0.86、移動性高気圧 ≈0.76、谷/前線 ≈0.69、南高北低 ≈0.58、台風 ≈0.41。
  - しきい値の操作で適合率–再現率のトレードオフを制御。プロトタイプ検索システムで有用性を検証。
- 含意・限界
  - 大量抽出の自動化に有効。一方、台風など多様性の大きい型やラベルの主観性が課題。
- 本研究への示唆
  - 教師あり学習の有効性を示す一方で、ラベル付けのコストや、台風のように多様なパターンを持つ分類対象の難しさといった課題も浮き彫りになりました。これが、本研究で教師なし学習アプローチを採用する一因となっています。

---

### 2) Takasuka et al. (2024)「自己組織化マップを用いた気圧配置のクラスタリングと 1km メッシュ天気データによる分析」

- 目的
  - 教師なし学習（Batch‑SOM）で気圧配置の代表パターンを抽出し、全国 1km 推計天気（晴/曇/雨雪）と対応付けて解釈。
- データ・設定
  - 入力：GPV 全球の SLP（2016/3–2024/10、09JST）、領域 15–55N/115–155E。
  - 前処理：領域平均差分 →PCA20 次元 →Batch‑SOM（10×10、学習 10 万）。
  - 事後解釈：冬/夏/梅雨/台風のキーワード日でノードにラベル付与。
- 主な結果
  - SOM 上で隣接ノードが類似配置を形成（構造の連続性）。各クラスタに対応する日本の天気分布を可視化。
  - 汎化評価（JRA‑3Q の 100 事例）：冬 100%、夏 84%、梅雨 76%、台風 52%（平均 78%）。
- 含意・限界
  - 教師なしでも連続的な型空間を作れ、地上天気との結び付けが可能。台風は多様性ゆえ精度が低め。
- 本研究への示唆
  - この研究は、教師なし学習の有効性と地上天気との連携の可能性を示しましたが、類似度指標としてユークリッド距離を使用していたため、パターンの構造的な特徴を捉える点に改善の余地がありました。この課題認識が、本研究の出発点となっています。

---

### 3) Philippopoulos et al. (2014, International Journal of Energy and Environment)「SOM と k-means の性能比較：南東欧の春季 MSLP 分類」

- 目的

  - コホネン型 SOM と k-means を、総観場（春季の海面更正気圧：MSLP）分類で正面比較し、得られるパターンの対応関係・頻度・季節性から実用性を評価。

- データ・設定

  - 入力：NCEP/NCAR Reanalysis 1 の日平均 MSLP（1948–2009、春期のみ）、2.5°×2.5°、領域 30–60N／10W–37.5E（南東欧）、全 5,704 日。
  - 前処理：PCA により 25 主成分へ次元削減（全分散の 99.01%）。
  - 手法：
    - k-means：ユークリッド距離、クラスタ数 k=6–13 を網羅し最適 k を選択（最適は 10 型）。
    - SOM：2 次元格子（12–36 ノードを探索、最適は 5×4=20 ノード、六角格子）、BMU はユークリッド距離。
  - 評価：SOM 型の日々のメンバー分布を各 k-means 型へクロス集計し、合成 MSLP 場・月別/累積頻度の対応を比較。

- 主な結果

  - 両手法とも「現実的」な総観型を与えるが、必要ノード数（型数）が異なる（k-means=10、SOM=20）。
  - 高気圧卓越型では両者の一致が高い一方、弱圧場や高低の組合せ型では差異も見られる。
  - SOM は非線形構造を写像し、近縁の総観モードが隣接ノードに自己配置（トポロジ保存）。遷移位相や中間型の理解に有利。
  - k-means は目的関数の局所最小に陥り得る一方、SOM は大域構造の近似に優位。
  - 両者とも事前に型数（ノード数）を与える必要があり、最終選択は図形の質的評価に依存。
  - 提案：SOM で多数の大気状態をまず抽出し、その後 k-means で実務的な日別カタログへ集約する二段階案。

- 含意

  - SOM の「隣接＝類似」という地図構造は、総観分類の可視性・解釈性を大きく高める。とはいえ、ユークリッド距離と型数の事前指定に依存する限界は残る。

- 本研究への示唆
  - 本研究の SOM 系実験（①〜③）や二段階クラスタリング（④）に対し、(a) SOM の可視化・遷移解釈の強み、(b) 型数事前指定の弱点、(c) 距離指標をユークリッドから構造敏感な SSIM/S1 へ置換すべき動機、を与える。著者らの二段階案（SOM→k-means）は、我々の「HAC ＋ k‑medoids（クラス数自動決定・medoid 代表）」という設計に発展的に接続可能である。

---

### 4) Jiang, Dirks & Luo (2013, Weather and Climate 33:52–75)「SOM によるニュージーランドの総観型分類と気象・大気質データの可視化」

- 目的

  - NCEP/NCAR の 1000hPa ジオポテンシャル高度（Z1000）から SOM で 25 の総観型を作成し、Auckland の局地気象・大気質（NO/NO2/O3）との関係を、SOM 平面上の「自己組織化（トポロジ保存）」を活かして直観的に可視化・解釈。

- データ・設定

  - 総観場：Z1000（1958–2010、0/12UTC）、2.5°、25S–55S／155E–170W（195 グリッド）。標準化は行わず微細な差異を保持。
  - SOM：二相バッチ学習（CP2）。Phase‑1 は大域構造の粗学習（近傍幅 5→1、50,000 反復）、Phase‑2 は微細構造の精緻化（近傍 2→1、90,000 反復）。マップは 5×5=25 型。BMU は二乗ユークリッド距離。
  - 局地気象：Auckland Airport の観測から P‑mode Varimax 回転 PCA で 2 指標を作成
    - PC1：SSW/NNE フロー指標（風向・放射と温湿度・降水の対照）
    - PC2：安定/不安定指標（低圧・西成分強風 vs 高圧・弱風東成分）
  - 大気質：O3（Sky Tower 高所、Musick Point 海岸）、NO/NO2（Musick Point、CBD の Queen St）。日平均。

- 主な結果

  - SOM 平面に 25 型が自己配置。西風トラフ群は右上、ブロッキングは左上、南西流は右下に集約。格子周縁に沿った時計回りで「進行する総観系」の遷移が可視化。
  - 型の季節頻度は文献（Kidson 系）と整合。ブロッキングは夏に多く、西風トラフは春に増加。
  - PC1/PC2 を SOM 上に投影すると、型ごとの局地気象応答（風向・安定度）が空間的パターンとして明瞭に現れる。空港の u/v から復元した風ベクトルも型の期待流向と整合。
  - 大気質：
    - O3 はトラフ（上縁・右縁：不安定・換気）で高く、下層からの換気・上層からの下降混合が一因。
    - ブロッキング下の海風（NE/E）は海岸（Musick Point）で O3 高・NOx 低、対して高所（Sky Tower）では安定化により O3 低。
    - 高圧（左下）は換気抑制で NOx が相対的に高まりやすいが、O3 供給が限られ NO2 は中庸に留まる局面も。
  - SOM のトポロジ保存が、総観—局地—大気質というスケール横断の関係を一枚の平面上で読み解く枠組みとして有効であることを実証。

- 含意

  - SOM は分類と同時に「関係の地図化」を可能にし、遷移・季節性・局地応答・環境影響を統合的に可視化できる強みを持つ。一方で、距離はユークリッド、型数は 25 に事前固定という前提に依存。

- 本研究への示唆
  - 本研究が目指す「分類の解釈性（可視化）と応用可能性（影響連携）」の観点で SOM の有効性を再確認させる。一方で、(a) ユークリッド距離の限界、(b) 型数の事前指定という課題が残る。これを受け、本研究では SSIM/S1 のような構造敏感な類似度を SOM に導入（②③）し、さらにクラス数自動決定・medoid 代表を備えた二段階クラスタリング（④）へ拡張することで、解釈性と実運用性の双方を強化する。

---

### 5) Winderlich et al. (2024, ESD)「改良 SSIM による二段階クラスタリングでの総観場分類」

- 目的
  - 気候モデル評価のため、距離ではなく構造類似（SSIM）を用い、クラス数を自動決定できる分類法を提案。
- 手法
  - SSIM（平均・分散・共分散を用いた構造類似、混合符号に耐性を持つ改良版）＋ HAC（類似閾値でマージ）と k‑medoids（代表を medoid）を反復。
  - 事前パラメータは SSIM の閾値 TH_merge のみ（人の“見た目の類似”を模す）。
- データ・検証
  - ERA‑Interim zg500（1979–2018、2°×3°、欧州域）。TH=0.40 で 37 クラス（0.425→52、0.45→89）。
  - 一貫性・分離性・時間安定（≥30 年で安定）・空間安定（解像度変更でも再現）・代表性（medoid と centroid の SSIM≳0.6）を満たす。
- 応用
  - CMIP6 の各日の出力を参照クラスに割当て、頻度・遷移・持続の確率分布を Jensen–Shannon 距離で比較し、循環場の妥当性を評価。
- 含意
  - 「まれな型」も落とさずに、物理解釈性の高いクラスを自動構築。モデル評価の新たな軸を提供。
- 本研究への示唆
  - SSIM を用いたクラス数自動決定・medoid 代表という先進的なクラスタリングの枠組みを提案しており、本研究の実験条件 ④ の設計に大きな示唆を与えています。

---

### 6) Doan et al. (2021, GMD)「S‑SOM v1.0：構造類似（SSIM）を用いた SOM」

- 目的
  - SOM の BMU 探索にユークリッド距離ではなく SSIM を導入し、構造（高低の位置・形・コントラスト）に敏感なクラスタリングを実現。
- データ・設定
  - ERA‑Interim の SLP（日本域、季節別）。SOM は複数ノード数で検証。比較：ED‑SOM、COR‑SOM。
- 主な結果
  - S‑SOM は ED‑SOM に比べ、シルエット係数が高く、トポロジ保存（Topographic Error）も概ね改善。COR‑SOM よりも良好なケースが多い。
  - 季節差（冬型の卓越）など「構造的」特徴をよく反映。計算時間は増えるが実用的。
- 含意
  - BMU の類似度定義を SSIM へ切り替えるだけで、物理的に解釈しやすいクラスタが得られる。
- 本研究への示唆
  - SOM の枠組みの中で、類似度指標を SSIM に変更するだけで性能が向上することを示しており、本研究の実験条件 ②（Batch SOM: SSIM）の直接的な理論的背景となります。

---

### 7) Sato & Kusaka (2021, JMSJ)「SLP パターン分類における類似度指標の統計比較」

- 目的
  - 類似度指標（相関、EUC、S1、SSIM、平均ハッシュ）の選択が SLP パターン選別に与える影響を、教師データ多数で統計比較。
- データ・設定
  - JRA‑55 の SLP（2007–2016、北西太平洋、6 時間ごと）。日本海低気圧（CSoJ）を対象に専門家多数決でラベル化（1,116 枚）。
- 主な結果
  - 平均・最大の選択率で S1 と SSIM が最良（EUC/相関/ハッシュを上回る）。ノイズを含む教師でも頑健。
  - EUC は信号中心の位置一致に強いが、全体構造の違いには弱い傾向。
- 含意
  - SLP のような場の類似では、勾配（S1）と構造（SSIM）が“見た目の類似”と整合的で、実務の自動抽出に有利。
- 本研究への示唆
  - SLP 分類において EUC よりも S1 スコアと SSIM が類似度指標として優れていることを統計的に実証しており、本研究でこれらの指標を導入する直接的な根拠となります。

### まとめ（本研究への接続）

- 監督あり（SVM）と教師なし（SOM/二段法）はそれぞれ長所があるが、総観パターンの「構造的な類似度」を適切に捉えることが精度・解釈性の鍵となる。
- SSIM（構造）や S1（勾配）は、EUC/MSE よりも人の判断と整合的で頑健であることが理論・実験の双方で示されている。
- 二段階クラスタリング（SSIM ＋ HAC＆k‑medoids）は、クラス数自動決定・medoid 代表・安定性という実運用上の利点を備え、循環評価（JS 距離）にも展開可能。
- 以上を踏まえ、本研究では「同一データ・同一評価系」で EUC/SSIM/S1×（SOM/二段法）を比較し、現実的な 15 基本ラベル（＋複合）に対する最適な組み合わせを明らかにする。これにより、先行研究で得られた可視化・検索・モデル評価の実装上の知見を統合し、精度と解釈性を両立する実用的な気圧配置分類フレームワークの設計指針を提示する。

## 実験計画

### 1. はじめに

気圧配置の客観分類は、天気・気候の理解や業務応用（検索・類型別検証・モデル評価）に不可欠である。日本域でも、教師あり学習で 6 基本型を自動判別した先駆研究（木村ほか, 2009）が、目視判読の労力軽減に有効であることを示した一方、(a) ラベル付与の主観性とコスト、(b) 台風のような多様で希少な型の性能低下、という限界を明確にした。教師なし学習では、自己組織化マップ（SOM）が 2 次元の拓撲保存マップ上に総観パターンを自己配置し、季節性や遷移、地上気象・大気質との関係を統合的に可視化できることが、ニュージーランド域の詳細研究（Jiang et al., 2014）や比較研究（Philippopoulos et al., 2014）で繰り返し実証されている。筆者らも日本域 SLP に対し Batch‑SOM を適用し、各クラスタと全国 1 km メッシュ天気の対応付けが有効であることを確認した（Takasuka et al., 2024）。しかし多くの SOM 研究は、(1) ベストマッチ探索にユークリッド距離（EUC）を採用し、(2) 型数（ノード数）を事前固定するという前提に依存してきた。

近年、この二つの前提そのものが分類性能を制約していることが、理論・実証の双方から示されている。まず、EUC/MSE は構造を持つ信号（気圧・高度場は“画像”とみなせる）同士の「見た目の類似度」を適切に測れず、同程度の MSE でも構造が大きく異なる事例が混在しうる（Wang & Bovik, 2009；Winderlich et al., 2024）。これに対し、画像分野で確立した構造類似度 SSIM は、明るさ・コントラスト・構造（共分散）を同時に評価でき、総観場の比較に適することが、合成例・再解析実データを通じて示されている（Mo et al., 2014；Winderlich et al., 2024）。SOM でも、BMU 探索を SSIM に置き換えた S‑SOM が、ED‑SOM よりクラスタ純度（シルエット）と拓撲保存（Topographic Error）で優れることが検証された（Doan et al., 2021）。また、SLP パターンの抽出では、勾配に敏感な S1 スコアと SSIM が COR/EUC/画像ハッシュより統計的に高精度で、ノイズを含む教師データに対しても頑健である（Sato & Kusaka, 2021）。

さらに、型数の事前固定という課題に対し、SSIM を類似度として階層的凝集（HAC）と k‑medoids を反復する二段階クラスタリングが提案され、(i) 類似度しきい値のみでクラス数を自動決定、(ii) クラスタ中心を実データ（medoid）で表現、(iii) 時間・空間解像度に対して安定、(iv) まれな型を落とさない、ことが示された（Winderlich et al., 2024）。この“medoid 中心”は、平均場（centroid）が構造を希釈し「雪だるま」的に拡散する k‑means の弱点を回避する。

著者らの先行研究（Takasuka et al., 2024）は、日本域 SLP に Batch‑SOM を適用して 10×10 ノードに総観型を自己配置し、全国 1km 推計天気と対応付けることで、型と地上天気の関係を可視化した。しかし、(a) 類似度に EUC を用いたこと、(b) ノード数の事前固定、という一般的な前提を踏襲しており、構造的な類似度や希少型の分離に改善余地があった。

以上を踏まえると、日本域の気圧配置分類における現代的な論点は次の三点に整理できる。

- (1) SOM の可視化・解釈力を活かしつつ、ユークリッド距離依存から SSIM/S1 など構造・勾配に敏感な指標へ移行する。
- (2) クラス数の事前指定と平均代表の弊害を避ける設計（閾値制御＋ medoid）を導入する。
- (3) 稀少だが重要な型（例：台風）を落とさず保持しつつ、出現頻度の高い主要型でも純度と再現性を両立させる。

先行研究はそれぞれ部分的に有効性を示したが、同一データ・同一評価系で両軸を系統比較した研究は乏しい。本研究はこのギャップを埋め、構造に敏感な類似度と medoid 中心のクラスタリングが、日本域の実問題（吉野型）でどの程度有効かを定量・定性的に明らかにする。

### 2. 本研究の目的

本研究の目的は、海面更正気圧（SLP）の気圧配置分類において、類似度指標（EUC／SSIM／S1）とクラスタリング手続き（Batch‑SOM／二段階クラスタリング）の組合せが、分類性能・希少型の抽出・可視化解釈性に及ぼす影響を、同一データ・同一評価系で比較し、最適な設計指針を提示することである。具体的には、以下の問いに答える。

- 目的 1（基準線の確立）

  - Batch‑SOM ＋ EUC をベースラインとして構築し、日本域 SLP に対する従来設定（EUC／事前型数指定／centroid 表現）の性能・限界（型の平均化・構造希釈・稀少型の取りこぼし）を定量化する。

- 目的 2（類似度の置換効果の検証）

  - SOM の BMU 類似度を SSIM（Doan et al., 2021）および S1（Sato & Kusaka, 2021）に置換した場合の、クラスタ純度・トポロジ保存・季節性・可視化解釈性（型地図の連続性）の改善度を、同一マップサイズ・評価軸で比較する。
  - 仮説：S1 は勾配が本質な冬型・前線型で、SSIM は形状・配置差の識別で、とくに EUC を上回る。

- 目的 3（クラス数自動決定・medoid 代表の効果検証）

  - 改良 SSIM に基づく Winderlich 型の二段階クラスタリング（HAC ＋ k‑medoids）を日本域 SLP に適用し、クラス数自動決定・medoid 代表が、(i) まれな型（台風など）の独立抽出、(ii) クラス間分離性と時間・空間安定性、(iii) 平均化による構造希薄化の回避、に与える効果を検証する。
  - 併せて、S1 による二段階版も実装し、構造（SSIM）対勾配（S1）の違いが自動クラスタ構築に与える影響を比較する。

- 目的 4（現実的ラベル体系に対する実用評価）

  - 吉野（2002）に基づく基本 15 型（＋複合）を評価の外部参照とし、Macro Recall（基本／複合）等の指標で方式間を公平比較する。加えて、台風等の稀少型については独立抽出の可否と誤混入の質的分析を行い、運用上の有用性を検討する。

- 目的 5（解釈性と展開可能性の提示）
  - 各方式で得られた代表パターン（とくに medoid）の地上天気との対応や季節頻度・遷移の可視化を提示し、SOM（Jiang et al., 2014）で実証された SOM の『関係の地図化』という強みを、SSIM/S1 や二段階法といった先進的アプローチと組み合わせることで、どこまで拡張できるかを検証する

このために、次の比較実験系を構築する。

- ① Batch‑SOM（EUC）: 基準系。一般的な SOM 設定のまま EUC を使用。
- ② Batch‑SOM（SSIM）: Doan et al. (2021) に準じ BMU を SSIM に置換し、構造敏感化。
- ③ Batch‑SOM（S1）: Sato & Kusaka (2021) に基づき BMU を S1 に置換し、勾配重視の類似度を検証。
- ④ 二段階クラスタリング（S1 ＋ HAC＆k‑medoids）: Winderlich et al. (2024) の SSIM‑ベース枠組みを S1 距離に置換し、しきい値 TH_merge によりクラス数を自動決定、代表は medoid とする。得られた medoid 群は SOM 平面へ配置して可視比較を行う。

評価は、吉野（2002）に基づく 15 基本ラベル（＋複合）を用いたマクロ再現率（複合も評価）、Micro Accuracy、ARI/NMI 等の客観指標に加え、(a) まれな型の独立抽出、(b) 代表天気図（centroid vs medoid）の“構造の希釈”の程度、(c) SOM の拓撲保存とノード間の連続性、を質的に点検する。これにより、

- 類似度指標の違いがもたらす本質的な効果（EUC→SSIM/S1）、
- 手続き（SOM vs medoid 二段法）のトレードオフ（頻出型の安定的再現 vs 希少型の分離）、
- 実運用に資する可視化・検索・代表事例提示の最適化（SOM の地図性と medoid の代表性の両立）、

を体系的に明らかにし、総観分類の精度・解釈性・運用性を同時に高める実践的フレームワークを提示する。

### 3. 使用データ

#### 3.1. 物理量と期間

海面更正気圧（SLP）の格子点データ。対象期間は 1991 年 1 月 1 日〜2000 年 12 月 31 日。
1 日 1 時刻（例：09JST 相当、実装は与えられた NetCDF の time 軸に準拠）。

#### 3.2. 領域と解像度

日本周辺の定常領域（図化は概ね 120–150E, 20–50N を想定。データの実格子に合わせて処理）。

#### 3.3. ラベル（正解データ）

吉野（2002）に基づく気圧配置型。

- 基本 15 ラベル: `1, 2A, 2B, 2C, 2D, 3A, 3B, 3C, 3D, 4A, 4B, 5, 6A, 6B, 6C`
- 上記基本ラベルの複合（例：`3A−2D`, `2A+2C` など）も含む。全日データにラベルあり。

#### 3.4. 前処理

SLP を hPa へ変換し、各日の空間平均（領域平均）を差し引いた偏差場を入力とする（季節変動の正規化は行わない）。以後すべての手法でこの同一入力を用いる。

### 4. 研究方法（実験条件）

4 条件を同一データ・同一 SOM サイズ（10×10）・同一評価指標で比較する。

#### 4.1. ① Batch SOM（基準）: ユークリッド距離（EUC）

- SOM: 10×10、ミニバッチ学習、反復 1 万回、ガウス近傍（σ は漸減）。
- BMU 距離: ユークリッド距離。
- 可視化: ノード平均の SLP 偏差マップ、ノードごとの基本ラベル分布ヒートマップ。

#### 4.2. ② Batch SOM: 構造類似度 SSIM

- SOM 設定は ① と同一、BMU 距離のみ SSIM に変更（Doan et al., 2021 の簡略一窓 SSIM に準拠）。
- 期待: 形状・配置の似たパターンを集約しやすく、EUC よりクラスタ純度・解釈性向上。

#### 4.3. ③ Batch SOM: S1（Teweles–Wobus スコア）

- SOM 設定は ① と同一、BMU 距離のみ S1 に変更（Sato & Kusaka, 2021 で有効性が示された勾配ベース）。
- 期待: 前線や冬型など勾配構造が本質の型で有利、雑音に強い。

#### 4.4. ④ 二段階クラスタリング（S1）＋ S1‑SOM 配置

- Step‑1（HAC）: クラスタの代表（メドイド）間の相互最近傍（MNN）ペアで、S1 距離が閾値`TH_MERGE`未満のものを反復的にマージ。
- Step‑2（k‑medoids）: 全サンプルを最も近いメドイドへ再割当 → メドイド再計算を収束まで反復。
- 最終クラスタ数が概ね 100 になるよう`TH_MERGE`を調整（必要に応じて自動探索）。SOM 条件（10×10）と可視比較可能にする。
- 可視化: 最終メドイドを S1‑SOM（コードブックでは重みではなく実データのメドイド）に並べ、マップとして配置。ノードごとの代表ラベル・月別分布等を付記。
- 期待: クラス数自動決定・クラス中心に実データ（medoid）採用により、構造の希釈（平均化）を避け、まれな型も保持（Winderlich et al., 2024 の強みを S1 で継承）。

### 5. 評価指標（4 条件で統一）

- Macro Recall（基本ラベル）: 各基本ラベル`l`について、クラスタの多数決ラベルが`l`であるクラスタ群に入った`l`の件数 / `l`の総件数。これを 15 ラベルで平均。1 ラベルが複数クラスタに分割されても正しくカウントされる。
- Macro Recall（複合考慮）: サンプルの複合ラベルを基本成分に展開し、予測（クラスタ多数決）がその成分のいずれかに一致すればその成分に対して正とカウントし、ラベルごとに再現率 → マクロ平均。

すべて同一の評価関数で算出し、方式間の公平性を担保する。

### 6. 実装・ハイパーパラメータ（主要）

- SOM: 10×10、学習反復 10,000、バッチ 512、学習率と σ は漸減、GPU 対応（PyTorch）。EUC/SSIM/S1 は BMU 距離のみ切替。
- 二段階クラスタ: 行 × 列チャンクで S1 距離を逐次計算（GPU）、HAC は MNN ＋ S1<`TH_MERGE`、k‑medoids は S1 距離による割当 → メドイド再計算を収束まで。最終クラスタ数 ≒100 に合わせて`TH_MERGE`を調整。
- 入出力: すべて SLP 偏差[hPa]。可視化範囲は日本周辺（115–155E, 15–55N）で統一。

## 実験結果

### 1. 全体結果の比較

4 つの実験条件で得られた分類性能（マクロ平均再現率）を以下に示す。

| 実験条件                           | MacroRecall (基本ラベル) | MacroRecall (複合考慮) |
| :--------------------------------- | :----------------------- | :--------------------- |
| ① Batch SOM (ユークリッド距離)     | 0.278                    | 0.194                  |
| ② Batch SOM (SSIM)                 | 0.235                    | 0.179                  |
| ③ Batch SOM (S1 スコア)            | 0.350                    | 0.241                  |
| ④ 2 段階クラスタリング (S1 スコア) | 0.303                    | 0.213                  |

S1 スコアを類似度指標として用いた手法 ③ (Batch SOM) が、両方の評価指標において最も高いスコアを記録した。 これは、Sato & Kusaka (2021) の研究で示された、気圧配置のような勾配情報が重要なデータに対して S1 スコアが有効であるという知見と一致する。

- ① の SOM マップ結果画像（10×10）
  ![画像](./image/1_maps_10x10.png)

- ② の SOM マップ結果画像（10×10）
  ![画像](./image/2_maps_10x10.png)

- ③ の SOM マップ結果画像（10×10）
  ![画像](./image/3_maps_10x10.png)

- ④ の SOM マップ結果画像（10×10）
  ![画像](./image/4_maps_10x10.png)

一方で、手法 ①（ユークリッド距離）と ②（SSIM）は、10x10 の SOM マップを視覚的に確認した際に、高気圧や低気圧がどの象限にあるかといった大局的な特徴でしか分類できておらず、細かいパターンの差異を捉えきれていない様子がうかがえた。特に SSIM を用いた手法 ② のスコアが最も低かった点は、SSIM が画像の構造的特徴を捉える一方で、本データセットの複雑なラベル体系に対しては S1 スコアほど有効でなかった可能性を示唆している。

### 2. 手法 ③ (S1-SOM) と手法 ④ (2 段階クラスタリング) の比較考察

本研究で最も注目すべきは、最も高いスコアを示した手法 ③ と、先進的なアルゴリズムである手法 ④ の比較である。スコア上は手法 ③ が優れているが、質的な内容をログから詳細に分析すると、各手法の特性と限界が見えてくる。

#### 2.1. レアパターンの抽出能力

手法 ④ は、データ数が非常に少ない「台風型」の分類において特筆すべき成果を上げた。ログを確認すると、手法 ④ は`Cluster_15`を代表ラベル「6B」（台風が本州およびその接岸地帯にある場合）とするクラスターとして明確に生成している。これは、データ全体の 0.4%程度しか存在しない稀なパターンを独立したクラスターとして分離できたことを意味し、アルゴリズムの分離能力の高さを示している。

対照的に、手法 ③ のログを詳細に分析すると、100 個のノードの中に「6B」を代表ラベルとするノードは一つも存在しなかった。個々の「6B」データは他の多数派ラベルのノードに吸収されてしまい、独立したパターンとして抽出するには至らなかった。

#### 2.2. スコア差の要因分析

レアパターンを抽出できた手法 ④ よりも、できなかった手法 ③ の方がスコアが高いのは、両者のクラスタリング戦略の違いに起因すると考えられる。

- 手法 ③ (S1-SOM) の戦略：主要パターンの"まとめ上げ"によるスコア獲得
  手法 ③ のログを見ると、「1（冬型）」や「3B（移動性高気圧）」といった出現頻度の高いラベルに対して、非常に純度の高い（Purity が高い）クラスターを複数形成していることがわかる（例：Node (7,1)の純度 65.5%）。SOM は、全てのデータを 100 ノードのいずれかに割り当てるため、似たような主要パターンを少数のノードに集約・特化させやすい。本研究で用いた評価指標は、あるラベルが複数のクラスターに分かれてもそれらを合算して再現率を計算するため、このような「得意なパターンで確実に点を稼ぐ」戦略がマクロ平均スコアを押し上げる要因となった。

- 手法 ④ (2 段階クラスタリング) の戦略：厳密な分離によるクラスターの細分化
  手法 ④ は、類似度の閾値に基づいて厳密にクラスタをマージ・再配置する。これにより「台風型」のような特異なパターンを分離できる一方、主要パターンに対してもより細かく、ニュアンスの異なる部分集団（サブタイプ）を生成する傾向がある。その結果、手法 ④ の再現率は「3B (0.39)」「3C (0.06)」「4B (0.05)」のように、手法 ③ が得意としていたであろう他の主要パターンでスコアを落としている。また、手法 ④ の「メドイド-代表ラベル一致率」が 0.3667 と低いことは、クラスターが単一のラベルで構成されているのではなく、複数の似て非なるパターンを含む、より複雑で細分化された集団であることを示唆している。結果として、平均スコアでは手法 ③ に及ばなかったと考えられる。

### 3. 結論と今後の展望

本研究の比較実験から、以下の結論が導かれる。

- 性能指標の観点: S1 スコアを類似度指標として用いた手法 ③ (Batch SOM) が、マクロ平均再現率において最も優れた性能を示した。これは、出現頻度の高い主要な気圧配置パターンを効率的に分類する能力に長けているためである。
- 質的・解釈可能性の観点: スコアでは劣るものの、手法 ④ (2 段階クラスタリング) は、データ数の少ない「台風型」のようなレアパターンを独立したクラスターとして抽出する高い能力を示した。これは、気象学的に特異で重要な現象（極端現象など）を探索する上で非常に価値のある特性である。

最終的に、どちらの手法が優れているかは研究の目的に依存する。「冬型」や「夏型」といった主要な季節のパターンを安定して分類することが目的ならば手法 ③ が適している。一方で、台風や特殊な前線など、出現頻度は低いが重要な意味を持つ気圧配置を網羅的に発見・分類することを目指すならば、手法 ④ のアプローチがより有望であると言える。

本研究は、気圧配置分類における"再現精度"と"発見能力"のトレードオフを明らかにした。主要な季節パターンを安定して分類する運用タスクでは S1-SOM が、一方、台風や豪雨に繋がりうる稀な気圧配置を探索する研究タスクでは二段階クラスタリングが、それぞれ優位性を持つと言える。

今後の展望としては、手法 ④ の長所を活かしつつ分類精度を向上させるため、季節ごとにデータを分割してクラスタリングを行うことや、クラスターのマージ閾値の最適化、少数派ラベルに重み付けを行う評価手法の導入などが考えられる。また、両手法の長所を組み合わせたハイブリッドアプローチも考えられる。例えば、まず手法 ④ を用いて台風のような希少パターンをデータセットから分離・抽出し、残りの大多数を占める主要パターン群に対して手法 ③ を適用することで、希少パターンの発見と主要パターンの高精度な分類を両立できる可能性がある。

## 参考文献

1. 木村広希, 川島英之, 日下博幸, & 北川博之. (2009). サポートベクターマシンを用いた気圧配置検出手法の提案 ── 西高東低冬型を対象として ──. 地理学評論 Series A, 82(4), 323-331.

2. 高須賀 匠, 高野 雄紀, 渡邊 正太郎, & 雲居 玄道. (2024). 自己組織化マップを用いた気圧配置のクラスタリングと 1km メッシュ天気データによる分析. 情報処理学会全国大会.

3. Philippopoulos, K., Deligiorgi, D., & Kouroupetroglou, G. (2014). Performance comparison of self-organizing maps and k-means clustering techniques for atmospheric circulation classification. methods, 13, 14.

4. Jiang, N., Dirks, K. N., & Luo, K. (2013). Classification of synoptic weather types using the self-organising map and its application to climate and air quality data visualisation. Weather and Climate, 33, 52-75.

5. Winderlich, K., Dalelane, C., & Walter, A. (2024). Classification of synoptic circulation patterns with a two-stage clustering algorithm using the modified structural similarity index metric (SSIM). Earth System Dynamics, 15(3), 607-633.

6. Doan, Q. V., Kusaka, H., Sato, T., & Chen, F. (2021). S-SOM v1. 0: a structural self-organizing map algorithm for weather typing. Geoscientific Model Development, 14(4), 2097-2111.

7. Sato, T., and H. Kusaka, 2021: Statistical intercomparison of similarity metrics in sea level pressure pattern classification. J. Meteor. Soc. Japan, 99, 993–1001, doi:10.2151/jmsj.2021-047
