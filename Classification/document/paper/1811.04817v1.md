時空間気候データへの畳み込みニューラルネットワーク適用の試験事例：クラスタ化された天気パターンの再同定
A test case for application of convolutional neural networks to spatio-temporal climate data: Re-identifying clustered weather patterns

著者・所属・連絡先

- Ashesh Chattopadhyay1, Pedram Hassanzadeh1,\*, Saba Pasha1,2
- 1 Rice University, Houston, 77005, USA
- 2 University of Pennsylvania, Philadelphia, 19104, USA
- - 対応著者: pedram@rice.edu

概要（Abstract）
畳み込みニューラルネットワーク（CNN）は、気候・環境データにおけるパターンの分類や同定に強力なツールとなり得る。しかし、対象データは時空間的・カオス的・非定常であることが多く、各データセットおよび各用途ごとに CNN の設計と評価が必要となる。さらに、CNN は教師あり手法であるため、大規模なラベル付きデータが必要である。ラベリングには専門家の時間を要し、関連する事例の少なさと相まって、新たな問題への CNN の適用を妨げる可能性がある。本研究では、(1) 非教師ありクラスタリング（K-means）でデータを自動ラベリングし、CNN がそのクラスタを再同定する性能を評価する手法を提案する。(2) この手法を用いて、結合気候モデルの北米における日々の大規模天気パターンを数千日分ラベリングし、4 つのクラスタレジームの再同定能力を示す。各クラスタあたり 1000 サンプル以上で学習した深層 CNN は精度 90%以上、3000 サンプルで 94%に到達した。精度は学習データサイズに対して単調だが非線形にスケールする。アーキテクチャとハイパーパラメータが性能に与える影響も検討する。

1. 序論（Introduction）

- 気候・環境データにおける時空間パターンの分類・同定は、循環レジームやテレコネクションの抽出、極端現象をもたらす天気パターンの識別、気候変動の影響の研究、海洋—大気相互作用の理解、大気汚染の輸送の調査などで重要である（例 1–5, 6–8, 9–17）。
- 従来は EOF 解析、クラスタリング（K-means、階層的法、自己組織化マップ）、線形回帰、特定の指数（ブロッキング指数など）が用いられてきたが、それぞれに欠点がある（6, 18）。ブロッキング指数は多数存在し相互に不一致で、将来変化に関する統計が矛盾することがある（10, 19）。
- 近年、機械学習の応用が加速し、ニューラルネットワークは対流パラメタリゼーションや雲シミュレーション（20–24）、天気予報（25, 26）、エルニーニョ予測（27）などで有望な成果を示している。CNN はパターン認識・画像処理で成功を収め（28, 29）、気候・環境データの分類にも有望である。Liu ら（30）や Racah ら（31）は、熱帯低気圧や前線、大気河川の同定で CNN の有望性を示した。
- 一方で、気候・環境データは高次元・非線形・非定常・多スケール・相関構造を持ち、しばしばカオス的である。観測データは短く疎で、観測ノイズもある（32–36）。このため、CNN のアーキテクチャやハイパーパラメータは各データセット・用途ごとに設計・評価されるべきである。
- さらに、CNN の適用開始時には大規模なラベル付きデータが必要だが、ラベリングには専門家の労力が必要であり、利用可能なラベル付きデータは限られる（31, 37）。これは新規課題への CNN 適用を妨げ得る。

目的

- (1) 非教師ありクラスタリング（K-means）で任意の時空間データを自動ラベリングし、そのラベルを用いて CNN の再同定性能を評価する簡便な手法を提案する。
- (2) この手法を用いて、最新の結合気候モデル出力内の北米の夏季・冬季の日々の大規模天気パターンを 4 クラスタに分けてラベリングし、CNN がそれらを同定できるかを示し、アーキテクチャ、ハイパーパラメータ、学習データサイズへの依存性を調べる。

2. 方法論（Methodology）

- アプローチは二段階：
  i) 非教師あり手法（K-means（38））でデータを n クラスタに分け、各パターンにクラスタインデックス（1..n）を割り当てる。
  ii) このインデックスをラベルとして CNN の学習・テストに用い、テスト時の再同定精度で CNN 性能を評価する。K-means の代わりに階層的法、期待値最大化法、SOM（3, 4, 39）なども利用可能だが、本目的（CNN 評価のための簡易ラベリング）には K-means が有効。
- 本手法は風、降水、海面水温、汚染物質分布など任意の気候・環境データに適用できる。本研究では北米の夏季・冬季の日平均天気パターンに焦点を当てる。

データの概要

- LENS（Large Ensemble）Community Project（40）：完全結合型 CESM1（Community Earth System Model v1）を用いた 40 メンバのアンサンブル。1920–2005 の歴史強制を使用。各メンバで初期状態に微小乱数を付加。
- 本研究では 500 hPa ジオポテンシャル高度 Z500 の日平均を用いる。Z500 の等値線は中層対流圏の大規模循環の流線にほぼ対応し、天気パターンの表現に頻用される（41）。1980–2005 年の夏季・冬季データを対象とし、北米域についてそれぞれ約 95,000 サンプル（夏）・同程度（冬）を得る。

クラスタリングとラベリング

- 季節（夏・冬）ごとに Z500 日データを n=4 クラスタに分類。クラスタリングは、帯状平均除去済み Z500 異常のデータ行列に EOF 解析を施し、分散の約 95%を保持する 22 の EOF に射影した PC 上で K-means を実行する。各日へ得られたクラスタインデックスを、その日の「完全な Z500 場」のラベルとして付与する。図 1 に、完全な Z500 場での 4 クラスタ中心（夏・冬）を示す。
- CNN への入力は完全な Z500 場。目的は、前処理を最小にしたデータでクラスタ再同定を行うことである。完全場は季節サイクルや内部変動（海洋—大気カップリングや放射強制の変化）を含み、より難題となる（1980–2005 間の非定常性を含む）。

CNN の概要

- CNN の主構成要素：畳み込み層（特徴抽出）、ReLU 層（非線形性付与）、プーリング層（次元削減・過学習抑制・並進/スケール不変性の付与）、全結合層（28, 29）。入力は Z500 から作成した画像で、小スケール冗長性を除くためダウンサンプリングする（図 3）。
- 学習時：ランダムに選んだ学習集合（TR）の画像とラベルを用いてバックプロパゲーション（29）でカーネル（重み）を学習する。CNN の利点は、カーネルをデータから学習できる点（手工設計不要）。
- テスト時：学習集合と非重複のテスト集合（TS）を与え、予測されるクラスタインデックスが正しいか評価する。

3. 結果（Results）

CNN の性能

- 夏季・冬季における CNN2（畳み込み 2 層）および CNN4（畳み込み 4 層）のテスト精度は以下の通り（混同行列は表 1・表 2 参照）。
  - CNN4：夏 93.3% ± 0.2%、冬 93.8% ± 0.1%
  - CNN2：夏 89.0% ± 0.3%、冬 86.6% ± 0.3%
- ここで ± は 5 つの独立なテスト集合の標準偏差。CNN4 は CNN2 より 4–7%高精度だが、計算資源の要求（時間・メモリ）は増加する。過学習抑制のため学習中に検証集合を用い、ハイパーパラメータをチューニングした。収束後の訓練精度とテスト精度がほぼ一致し、標準偏差も小さいことから、クラスは「暗記」でなく「学習」されていることが示唆される。なお、本データで N≤12000 の範囲では、畳み込み層を 4 層超に増やすと過学習が生じやすい。

学習データサイズに対する精度スケーリング

- 実務的関心：「どれだけのデータがあれば妥当な精度が出るか？」に対し、理論的境界やスケーリングは未確立（43）。本データでは、テスト精度は学習集合サイズ N に対し単調だが非線形に増加した（図 4）。
  - CNN4：N=500（クラスタ当たり 125）で約 64%、N=1000 で 80%超、N=8000 で 90%超、N=12000 で約 93%。
  - CNN2 も同様の傾向だが、同じ N では CNN4 より低精度。
- N=18000 で夏季 CNN4 のテスト精度は 94.1%に微増（N=12000 時 93.3%）。N 増加による改善は漸進的。

誤分類パターンの検討

- 夏季 CNN4 では、クラスタ C2 が最も誤分類されやすく、C4 が最も誤分類されにくいなど、クラスタ間で非対称性が見られる（表 1・表 2）。視覚的にクラスタ中心が類似して見えない場合でも、誤分類の偏りが生じる例がある。
- 誤差要因は主に二つ：
  1. 学習の不完全性（ハイパーパラメータ最適化や学習データ不足）。本研究では ADAM（45）などで探索したが、さらなる最適化余地はある。
  2. ラベリングの不完全性（K-means は各パターンを一意に割当てるため、境界的サンプルが生じる）。シルエット値 s を用いてクラスタの凝集度・分離度を評価すると、s<0 の境界的サンプルは s>0.4 のサンプルより誤分類が多い（誤分類率：11.0% vs 4.8%、表 3）。従って、テスト誤差の一部（夏季 CNN4 で 6.7%）はクラスタリング由来の不適切ラベルに起因する可能性がある。必要ならファジィ c-means（47）などのソフトクラスタリングを用いる選択肢もある。

4. 議論（Discussion）

- 提案した「非教師ありクラスタリングによる自動ラベリング → CNN 再同定評価」の戦略は、各データ型での CNN アーキテクチャ・ハイパーパラメータの能力と限界、学習データサイズに対するスケーリングを、対象問題へのラベリング投資前に検証するのに有用である。
- 日々の大規模天気パターンに対する解析は、最小限の前処理で、カオス的・多スケール・非定常時空間データにおける CNN の高い識別能力（90%超）を示した。先行研究（30, 31）の二値分類を超えて、4 クラス分類で 2000 サンプル/クラスタ以上で 90%超を達成した。
- CNN と RNN（LSTM やテンソルトレイン RNN など）を結合すれば、時空間予測（例：降水ナウキャスト（50））へ拡張できる可能性がある（48, 49）。

5. データと手法（Data and Methods）

LENS データ

- CESM1 40 メンバ・水平解像度約 1 度。1920–2005 の歴史強制。Z500 日平均、北緯 30–90 度・東経 200–315 度（66×97 格子）。夏（JJA）92 日/夏 ×26 年 ×40 メンバ（計 95,680 日）、冬（DJF）90 日/冬 ×26 年 ×40 メンバ（計 95,508 日）。

クラスタリング

- 帯状平均除去 Z500 異常の EOF 解析を行い、分散 95%を説明する 22PC を保持。これらに対して K-means（38）を初期中心を変えて 1000 回繰返し、各日にクラスタインデックス k ∈ {1,2,3,4} を割当てる。
- n=4 は最適数の追求ではなく、(i) クラスタ中心が十分に区別可能であり、(ii) 多クラス再同定の難易度と、(iii) 各クラスタの十分なサンプル数のバランスをとるために選択。

ラベリングとアップ/ダウンサンプリング

- 得られたインデックスで「完全な Z500 日場」をラベリング。完全場を用いる理由：
  (1) 異常場よりもクラス間差が微妙で難題。
  (2) 季節サイクルや低周波カップリング、放射強制変化などの非定常性を保持。
  (3) データ前処理を最小化するという応用上の意図。
- 前処理は図 3 のアップ/ダウンサンプリングに限定。66×97 の Z500 場を RGB 画像（342×243）にレンダリング後、バイキュービック補間で 28×28×3 にダウンサンプリングし、画素強度を平均 0・標準偏差 1 に標準化。小スケール変動（バロクリニック不安定など）はランダム性が強く過学習の温床となるため、ダウンサンプリングで除去。ダウンサンプリングなしでは単純なランダム初期化では学習が困難で、選択的初期化（Xavier（51））でも小スケールへの過学習のためテスト精度が低い。多スケール画像でのダウンサンプリングの必要性は他分野でも報告（52）。小スケールが重要な応用では局所化（53）などを用いる。
- 本研究では単一変数（Z500）のみを扱うため RGB の 3 チャネルを同一スカラー場の表現に使用。将来は複数変数を各チャネルに割当可能。

畳み込みニューラルネットワーク（CNN）

- 実装：TensorFlow（54）。AlexNet 系（33）に準拠した 2 種類のネット：
  - CNN2：畳み込み 2 層（フィルタ数 16, 32、カーネル 5×5、ゼロパディング）、各層に ReLU と MaxPooling（2×2, stride=1）。出力特徴マップ 7×7×64 を全結合層（1024 ユニット）へ。損失はクロスエントロピー＋ L2 正則化（係数 λ）。過学習抑制にドロップアウト（確率 p）。学習率 α は ADAM で適応最適化。Softmax でクラス確率を出力。
  - CNN4：CNN2 に畳み込み 2 層を追加（フィルタ数 8,16,32,64）。後段 2 層の後に MaxPooling。
- 学習・検証・テスト：
  - 例：N=12000（クラスタあたり 3000）を学習集合（TR）。独立な検証集合 4 個（各クラスタ 1000）、テスト集合 5 個（各クラスタ 1000）。TR・検証・テストは相互に非重複。クラス不均衡を避けるため各クラスタのサンプル数を同数に。
  - 学習はバッチサイズ 32、データシャッフル。α, λ, p を調整し、損失低下と高精度を達成（図 5 に適切/不適切な設定時の損失・精度のエポック変化例）。カーネルサイズ 5×5 が最良の検証・テスト精度を与えた。
  - 検証精度が低い場合は λ, p を手動調整して再学習。畳み込み層数（2–8）やカーネルサイズ（5×5〜11×11）の影響も評価。N=12000 では 4 層超で過学習が顕著。
  - テストは最良モデルを 5 つの TS に一回ずつ適用。平均と標準偏差を表 1・2 に報告。
  - N の効果（500〜8000）：学習は各クラスタ N/4、テストは各クラスタ N/8（四捨五入）。

代替アプローチ：画像ではなくデータ行列への CNN 適用

- 画像化せず、各日の Z500 場（97×66）を列ベクトルとしてデータ行列 X を作り、X に直接 CNN を適用しても同等精度が得られる。この場合はアーキテクチャを調整（畳み込み 4 層のフィルタ 8,8,16,32、全結合 200 ユニットなど）すると最良。

図表（キャプションの要約）

- 図 1：夏（JJA）・冬（DJF）における完全 Z500 場での 4 クラスタ中心（単位 m）。
- 図 2：CNN4 の構成（畳み込み層 8,16,32,64 フィルタ、5×5 カーネル、MaxPool 2×2）。
- 図 3：アップ/ダウンサンプリング手順（66×97 → RGB342×243 → 28×28×3、標準化）。
- 図 4：テスト精度の N 依存（CNN2/4、夏/冬）。
- 図 5：適切/不適切なハイパーパラメータ設定における損失・精度の学習曲線例（α, λ, p を明示）。

表（本文の記載に基づく）

- 表 1（夏）：テスト集合（各クラスタ 1000×5 セット）の混同行列（平均 ± 標準偏差）。総合精度 CNN4 93.3%±0.2%、CNN2 89.0%±0.3%。
- 表 2（冬）：同様。総合精度 CNN4 93.8%±0.1%、CNN2 86.6%±0.3%。
- 表 3（夏・CNN4）：シルエット値 s による正誤分類率。s<0：正 89.0% / 誤 11.0%。s>0.2：正 94.2% / 誤 5.8%。s>0.4：正 95.2% / 誤 4.8%。

謝辞（Acknowledgements）
本研究は NASA（80NSSC17K0266）と NSF（AGS-1552385）の助成を受けた。Stampede2/Bridge GPU クラスターおよび Azure は XSEDE 割当 ATM170020 および Microsoft AI for Earth の助成による。助言と議論に対し、Ashkan Borna, Rohan Mukherjee, Ebrahim Nabizadeh, Shashank Sonkar に感謝する。

参考文献（References）
［本文中の番号どおりに原典を記載：Mo & Ghil (1988) ほか、2–54 まで。ここでは抜粋のみ示す］

1. Mo, K., Ghil, M. (1988) J. Geophys. Res. Atmos., 93, 10927–10952.
2. Thompson, D. W. J., Wallace, J. M. (1998) Geophys. Res. Lett., 25, 1297–1300.
   …
3. Krizhevsky, A., Sutskever, I., Hinton, G. E. (2012) NIPS, 1097–1105.
   …
4. Kay, J. E. et al. (2015) Bull. Amer. Meteor. Soc., 96, 1333–1349.
   …
5. Abadi, M. et al. (2016) OSDI 12, 265–283.

重要な注記

- 本ファイルは PDF から抽出されたテキストに基づく日本語訳であり、図（Fig. 1–5）や表（Table 1–3）の画像は含まれていません。図表の説明は本文の記述・キャプションに基づき反映しています。
- 数式・記号はテキストとして表現しています（例：f(x)=max(0,x)、K(x_i,x_j)=exp(−δ·||x_i−x_j||^2)）。
